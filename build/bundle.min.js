"use strict";var Util={};Util.setCookie=function(t,e,n){var a=new Date,r=void 0,i=App.cookieDomain;n&&-1!==n||(n=360),a.setTime(a.getTime()+24*n*60*60*1e3);var o=t+"="+e+";"+(r="expires="+a.toUTCString())+";path=/;domain="+i;document.cookie=o},Util.getCookie=function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var r=n[a];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return""},Util.deleteCookie=function(t){console.log("deleting the cookie "+t);var e=t+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";document.cookie=e},Util.loadNumberFormatters=function(){Util.comma=function(t){return isNaN(t)||void 0===t?"":d3.format(",.0f")(t)},Util.decimalOne=d3.format(".1f"),Util.decimalTwo=d3.format(".2f"),Util.percentize=d3.format("%"),Util.percentizeDec=d3.format(".1%"),Util.monetize=d3.format("$,f"),Util.formatSI=d3.format(".2s")},Util.loadNumberFormatters(),Util.scrollTo=function(t){document.getElementById(t).scrollIntoView()},Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Util.getIndicatorClass=function(t){return t.split(".").join("-")},Util.getIndicatorId=function(t){return t.split("-").join(".")},Util.sortByKey=function(t,e,n){return t.sort(function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}),n?t.reverse():t},Util.truncateText=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=t.split(" ");if(1===n.length||t.length<=e)return t;for(var a="",r=0,i=0;i<n.length&&r+n[i].length<e;)i>0&&(a+=" "),a+=n[i],r+=n[i].length,i++;return a+"..."},Util.populateSelect=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};void 0===n.valKey&&(n.valKey=""),void 0===n.nameKey&&(n.nameKey="");var a=d3.select(t).selectAll("option").data(e);a.exit().remove();a=a.enter().append("option").merge(a).attr("value",function(t){return"function"==typeof n.valKey?n.valKey(t):""===n.valKey?t:t[n.valKey]}).text(function(t){return"function"==typeof n.nameKey?n.nameKey(t):""===n.nameKey?t:t[n.nameKey]}),n.selected&&("boolean"==typeof n.selected?a.attr("selected",n.selected):"function"==typeof n.selected&&a.attr("selected",function(){if(n.selected($(this).attr("value")))return!0}))},Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.getInputNumVal=function(t){var e=$(t),n=Util.strToFloat(e.val());return""===n?0:isNaN(n)||n<0?(e.val(0),0):(e.val(d3.format(",")(n)),n)},Util.msieversion=function(){return!!(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))};var User={};User.targetScoreType="target",User.targetScore=4,User.buyOrLease="lease";var App={};!function(){App.lang="en",App.choseLang=!1,App.demoMode=!1,App.cookieDomain="",App.scoreLabels="fr"===App.lang?{1:"Pas de capacité",2:"Capacité limitée",3:"Capacité développée",4:"Capacité démontrée",5:"Capacité durable"}:{1:"No Capacity",2:"Limited Capacity",3:"Developed Capacity",4:"Demonstrated Capacity",5:"Sustainable Capacity"},App.initialize=function(t){var e=Util.getCookie("lang");""===e?$(".language-modal").modal("show"):(App.lang=e,App.choseLang=!0);var n=navigator.userAgent;-1===n.search("Chrome")&&-1===n.search("Firefox")&&noty({timeout:!1,maxWidth:400,text:"<b>Warning!<br>This tool is designed to be used in Google Chrome or Mozilla Firefox! Please switch to one of these browsers for optimal performance.</b>"}),d3.queue().defer(d3.json,"data/country_specific_parameters.json").defer(d3.json,"data/jee_costing_data.json").defer(d3.json,"data/jee_score_data.json").defer(d3.json,"data/currencies.json").defer(d3.json,"data/global_base_costs.json").defer(d3.json,"data/global_staff_multipliers.json").defer(d3.json,"data/country_names_en_fr.json").defer(d3.json,"data/currency_names_en_fr.json").await(function(e,n,a,r,i,o,s,c,l){e?noty({type:"error",text:"Error loading data files. Please contact the tool administrator"}):(App.countryParams=n,App.jeeScoreData=_.groupBy(r,"code"),App.countryParams.forEach(function(t){var e=t.abbreviation,n=c.find(function(t){return t.iso2===e});n&&(t.name_fr=n.fr)}),App.jeeTree=a,App.cleanJeeTree=a.map(function(t){return $.extend(!0,{},t)}),App.currencies=i,App.currencies=_.mapObject(App.currencies,function(t,e){var n=e,a=l.find(function(t){return t.iso3===n});return a&&(t.name_fr=a.fr),t}),App.globalBaseCosts=o,App.globalStaffMultipliers=s,App.whoAmI={},App.changeLanguage(App.lang),App.demoMode?d3.text("data/KE20170904-demo.ihr",function(e,n){App.loadSessionData(n,function(e,n){e||noty({text:"There was an issue loading the demo data."}),App.updateAllCosts(),t()})}):(App.updateAllCosts(),t()))})},App.siFormat=function(t){return d3.format(",.3s")(t).replace("G","B")},App.numberFormat=function(t){return t<=100?Math.round(t):t<=1e6?d3.format(",.3r")(t):App.siFormat(t)},App.moneyFormat=function(t){return App.numberFormat(t)+" "+App.whoAmI.currency_iso},App.moneyFormatShort=function(t){return App.siFormat(t)+" "+App.whoAmI.currency_iso},App.moneyFormatLong=function(t){return d3.format(",")(t)+" "+App.whoAmI.currency_iso},App.normalCcIds=["p","d","r"],App.getCapacity=function(t){var e=t.includes(".")?t.split(".")[0].toLowerCase():"o",n=t.toLowerCase(),a=App.jeeTree.find(function(t){return t.id===e});return a?a.capacities.find(function(t){return t.id===n}):null},App.getIndicator=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?2:1,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=App.getCapacity(n);return r?r.indicators.find(function(t){return t.id===a}):null},App.getPrevIndicator=function(t,e){var n=t.includes(".")?t.split(".")[0].toLowerCase():"o",a=App.jeeTree.findIndex(function(t){return t.id===n}),r=App.jeeTree[a],i=r.capacities.findIndex(function(e){return e.id===t}),o=r.capacities[i],s=o.indicators.findIndex(function(t){return t.id===e});if(s>0)return o.indicators[s-1];if(i>0){var c=r.capacities[i-1];return c.indicators[c.indicators.length-1]}if(a>0){var l=App.jeeTree[a-1],p=l.capacities[l.capacities.length-1];return p.indicators[p.indicators.length-1]}return null},App.getNextIndicator=function(t,e){var n=t.includes(".")?t.split(".")[0].toLowerCase():"o",a=App.jeeTree.findIndex(function(t){return t.id===n}),r=App.jeeTree[a],i=r.capacities.findIndex(function(e){return e.id===t}),o=r.capacities[i],s=o.indicators.findIndex(function(t){return t.id===e});return s<o.indicators.length-1?o.indicators[s+1]:i<r.capacities.length-1?r.capacities[i+1].indicators[0]:a<App.jeeTree.length-1?App.jeeTree[a+1].capacities[0].indicators[0]:null},App.getAction=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?3:2,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=App.getIndicator(n);return r?r.actions.find(function(t){return t.id===a}):null},App.getInput=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?4:3,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=App.getAction(n);return r?r.inputs.find(function(t){return t.id===a}):null},App.getLineItem=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?5:4,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=App.getInput(n);return r?r.line_items.find(function(t){return t.id===a}):null},App.getNeededActions=function(t){return t.score?t.actions.filter(function(e){return App.getNeededInputs(e.inputs,t.score).length}):[]},App.getNeededInputs=function(t,e){return e?t.filter(function(t){return App.getNeededLineItems(t.line_items,e).length}):t},App.getNeededLineItems=function(t,e){if("step"===User.targetScoreType)return t.filter(function(t){return t.score_step_to.includes(String(+e+1))});if("target"===User.targetScoreType){var n=d3.range(+e+1,User.targetScore+1);return t.filter(function(t){for(var e=0;e<t.score_step_to.length;e++)if(n.includes(+t.score_step_to[e]))return!0;return!1})}return[]},App.needLineItem=function(t){},App.getIndicatorScore=function(t){return App.getIndicator(t).score},App.getAverageCurrentScore=function(t){var e=[];return t.forEach(function(t){t.score&&e.push(t.score)}),d3.mean(e)},App.getAverageTargetScore=function(t){var e=[];return t.forEach(function(t){t.score&&e.push(App.getTargetScore(t))}),d3.mean(e)},App.getTargetScore=function(t){if("step"===User.targetScoreType){if(t.score)return t.score>=4?t.score:t.score+1}else if("target"===User.targetScoreType)return t.score&&t.score>User.targetScore?t.score:User.targetScore;return null},App.setIndicatorScore=function(t,e){App.getIndicator(t).score=e},App.updateAllCosts=function(){var t=App.getExchangeRate();App.jeeTree.forEach(function(e){e.startupCost=0,e.capitalCost=0,e.recurringCost=0,e.capacities.forEach(function(n){n.startupCost=0,n.capitalCost=0,n.recurringCost=0,n.indicators.forEach(function(e){e.startupCost=0,e.capitalCost=0,e.recurringCost=0,e.actions.forEach(function(n){n.startupCost=0,n.capitalCost=0,n.recurringCost=0,n.inputs.forEach(function(a){a.startupCost=0,a.capitalCost=0,a.recurringCost=0,a.line_items.forEach(function(e){return e.cost=App.getLineItemCost(e,t)});App.getNeededLineItems(a.line_items,e.score).forEach(function(t){"start-up"===t.line_item_type?a.startupCost+=t.cost:"capital"===t.line_item_type?a.capitalCost+=t.cost:"recurring"===t.line_item_type&&(a.recurringCost+=t.cost)}),a.costed&&(a.isCustomCost?(n.startupCost+=a.customStartupCost,n.recurringCost+=a.customRecurringCost):(n.startupCost+=a.startupCost,n.capitalCost+=a.capitalCost,n.recurringCost+=a.recurringCost))}),e.startupCost+=n.startupCost,e.capitalCost+=n.capitalCost,e.recurringCost+=n.recurringCost}),n.startupCost+=e.startupCost,n.capitalCost+=e.capitalCost,n.recurringCost+=e.recurringCost}),e.startupCost+=n.startupCost,e.capitalCost+=n.capitalCost,e.recurringCost+=n.recurringCost})})};App.getLineItemCost=function(t,e){var n=App.globalBaseCosts.find(function(e){return e.id===t.base_cost});if(!n)if(n=App.globalBaseCosts.find(function(e){return e.id===t.base_cost+"."+User.buyOrLease}),"buy"===User.buyOrLease)t.line_item_type="start-up",t.score_step_to=[String(d3.min(t.score_step_to))];else{t.line_item_type="recurring";for(var a=[],r=+d3.min(t.score_step_to);r<5;r++)a.push(String(r));t.score_step_to=a.slice(0)}if(!n)return console.log("Warning! Cost object not found for id: "+t.base_cost),0;var i=n?n.cost:0;if(t.staff_multiplier){var o=App.globalStaffMultipliers.find(function(e){return e.id===t.staff_multiplier});o&&(i*=o.count)}return t.country_multiplier&&App.whoAmI.name&&(i*=function(t){var e=function(t){var e=App.whoAmI.multipliers[t];return void 0===e||null===e||""===e?0:e};switch(t){case"intermediate_1_and_2_count":return e("intermediate_1_area_count")+e("intermediate_2_area_count");case"intermediate_1_and_local_area_count":return e("intermediate_1_area_count")+e("local_area_count");default:return e(t)}}(t.country_multiplier)),t.custom_multiplier_1&&(i*=App.getMultiplierValue(t.custom_multiplier_1)),t.custom_multiplier_2&&(i*=App.getMultiplierValue(t.custom_multiplier_2)),n&&"Salaries"===n.subheading_name&&(i*=1+App.whoAmI.staff_overhead_perc),i*=e||App.getExchangeRate(),Math.round(i)},App.getCostText=function(t){var e=t.startupCost+t.capitalCost,n=t.recurringCost;return n?App.moneyFormat(e)+" + "+App.moneyFormat(n)+"/yr":App.moneyFormat(e)},App.getCustomCostText=function(t){return t.isCustomCost?App.moneyFormat(t.customStartupCost)+" + "+App.moneyFormat(t.customRecurringCost)+"/yr":""},App.getNumIndicatorsCosted=function(t){return t.indicators.filter(function(t){return App.isIndicatorComplete(t)}).length},App.getExchangeRate=function(){if(!App.whoAmI.name)return 1;return App.currencies[App.whoAmI.currency_iso].exchange_rates.find(function(t){return"USD"===t.convert_from}).multiplier},App.getMultiplierValue=function(t){if("number"==typeof t)return t;var e=t.split(" ");return parseFloat(e[0])},App.isIndicatorComplete=function(t){return!!t.score&&App.getNeededActions(t).every(function(e){return App.isActionComplete(e,t.score)})},App.isActionComplete=function(t,e){return!!e&&App.getNeededInputs(t.inputs,e).every(function(t){return t.costed})},App.changeLanguage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t.toLowerCase().trim(),App.lang=t,User.lang=t,App.jeeTree.forEach(function(t){t.name=t["name_"+App.lang];var e=["name","target_description","as_measured_by","desired_impact","notes"];t.capacities.forEach(function(t){e.forEach(function(e){t[e]=t[e+"_"+App.lang]});var n=["name","score_descriptions"];t.indicators.forEach(function(t){n.forEach(function(e){t[e]=t[e+"_"+App.lang]}),t.actions.forEach(function(t){t.name=t["name_"+App.lang],t.inputs.forEach(function(t){t.name=t["name_"+App.lang];var e=["name","description","category_tag","function_tag","custom_multiplier_1","custom_multiplier_2","references","where_find_base_cost"];t.line_items.forEach(function(t){e.forEach(function(e){t[e]=t[e+"_"+App.lang]})})})})})})}),App.globalBaseCosts.forEach(function(t){["name","description","tab_name","subheading_name","cost_unit"].forEach(function(e){t[e]=t[e+"_"+App.lang]})}),App.globalStaffMultipliers.forEach(function(t){["name","description","tab_name","subheading_name"].forEach(function(e){t[e]=t[e+"_"+App.lang]})}),"fr"===App.lang?d3.formatDefaultLocale({decimal:",",thousands:" ",grouping:[3],currency:["","$"]}):d3.formatDefaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),Util.loadNumberFormatters(),Util.setCookie("lang",App.lang),!1===e.reset||crossroads.parse(hasher.getHash()),$("title").text("fr"===App.lang?"Outil d'évaluation des coûts du RSI":"IHR Costing Tool")},App.getCompleteIndicatorTree=function(){var t=[];return App.jeeTree.forEach(function(e){e.capacities.forEach(function(e){e.indicators.forEach(function(e){if(App.isIndicatorComplete(e)){var n=Object.assign({},e),a=App.getNeededActions(n);n.targetScore=App.getTargetScore(n),n.actions=[],a.forEach(function(t){if(App.isActionComplete){var a=Object.assign({},t),r=a.inputs.filter(function(t){return t.costed}),i=App.getNeededInputs(r,e.score);a.inputs=[],i.forEach(function(t){var n=Object.assign({},t),r=App.getNeededLineItems(n.line_items,e.score);n.line_items=[],r.forEach(function(t){var e=Object.assign({},t);n.line_items.push(e)}),a.inputs.push(n)}),n.actions.push(a)}}),t.push(n)}})})}),t},App.getScoredIndicatorTree=function(){var t=[];return App.jeeTree.forEach(function(e){e.capacities.forEach(function(e){e.indicators.forEach(function(e){if(e.score){var n=Object.assign({},e),a=App.getNeededActions(n);n.targetScore=App.getTargetScore(n),n.actions=[],a.forEach(function(t){var a=Object.assign({},t),r=a.inputs,i=App.getNeededInputs(r,e.score);a.inputs=[],i.forEach(function(t){var n=Object.assign({},t),r=App.getNeededLineItems(n.line_items,e.score);n.line_items=[],r.forEach(function(t){var e=Object.assign({},t);n.line_items.push(e)}),a.inputs.push(n)}),n.actions.push(a)}),t.push(n)}})})}),t},App.getAllIndicatorTree=function(){var t=[];return App.jeeTree.forEach(function(e){e.capacities.forEach(function(e){e.indicators.forEach(function(e){t.push(e)})})}),t},App.downloadText=function(t,e){var n="data:application/csv;charset=utf-8,"+escape(e),a=document.createElement("a");a.href=n,a.style="visibility:hidden",a.download=t+".ihr",document.body.appendChild(a),a.click(),document.body.removeChild(a)},$.tooltipster.setDefaults({contentAsHTML:!0,trigger:"hover",offset:[5,-25],theme:"tooltipster-shadow",maxWidth:320}),$.noty.defaults.type="warning",$.noty.defaults.layout="center",$.noty.defaults.timeout=2e3}();var Routing={};!function(){function t(t,e){if(App.whoAmI.abbreviation||!n.includes(t)){!function(t,e){var n="en"!==App.lang?t+"-"+App.lang:t;$("#page-content").html(Routing.templates[n](e)),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="en"!==App.lang?"nav-fr":"nav";$("#nav-content").html(Routing.templates[e](t)),$(".nav-item").click(function(){var t=$(this).attr("page");void 0!==t&&hasher.setHash(t)}),$(".tool-name").click(function(){return hasher.setHash("")}),$(".evaluation-dropdown .dropdown-item, .costing-dropdown .dropdown-item").click(function(){hasher.setHash($(this).attr("page"))}),$(".language-dropdown .dropdown-item").click(function(){App.changeLanguage(d3.select(this).attr("lang"))})}(e),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="en"!==App.lang?"footer-fr":"footer";$("#footer-content").html(Routing.templates[e](t))}(e),!1===App.choseLang&&($(".language-modal").modal("show"),App.choseLang=!0)}(t);for(var a=arguments.length,r=Array(a>2?a-2:0),i=2;i<a;i++)r[i-2]=arguments[i];(function(t){"home"===t&&(t="");d3.selectAll(".nav-item").classed("active",function(){return $(this).attr("page")===t})}).apply(void 0,[t].concat(r)),e&&e.apply(void 0,r)}else{hasher.setHash("country");var o="fr"===App.lang?"<b>Aucun pays sélectionné!</b><br>Veuillez sélectionner un pays et compléter l'évaluation avant de entrer les coûts.</b>":"<b>No country selected!</b><br>Please select a country and complete assessment before entering costs.</b>";noty({timeout:5e3,text:o})}}function e(t){crossroads.parse(t)}Routing.templates={},Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(t,e){Routing.templates[e.id.replace("-template","")]=Handlebars.compile($(e).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){t("home",App.initHome),window.scrollTo(0,0)}),crossroads.addRoute("/country",function(){t("country",App.initCountry),window.scrollTo(0,0)}),crossroads.addRoute("/overview",function(){t("overview",App.initOverview),window.scrollTo(0,0)}),crossroads.addRoute("/scores",function(){hasher.setHash("scores/p-1/1")}),crossroads.addRoute("/scores/:{ccId}:",function(t){hasher.setHash("scores/"+t+"/1")}),crossroads.addRoute("/scores/:{ccId}:/:{indId}:",function(e,n){void 0===n&&void 0!==e?(n="1",hasher.setHash("scores/"+e+"/"+n)):void 0===n&&void 0===e&&(n="1",e="p-1",hasher.setHash("scores/"+e+"/"+n)),t("scores",App.initScores,e,n)}),crossroads.addRoute("/costsinstructions",function(){t("costs-instructions",App.initCostsInstructions),window.scrollTo(0,0)}),crossroads.addRoute("/costs",function(){hasher.setHash("costs/population")}),crossroads.addRoute("/costs/:{whoTab}:",function(e){t("who",App.initWho,e),window.scrollTo(0,0)}),crossroads.addRoute("/costs/:{ccId}:/:{indId}:",function(e,n){!n&&e?(n="1",hasher.setHash("costs/"+e+"/"+n)):n||e||(n="1",e="p-1",hasher.setHash("costs/"+e+"/"+n)),t("costs",App.initCosting,e,n),window.scrollTo(0,0)}),crossroads.addRoute("/results",function(){t("results",App.initResults),window.scrollTo(0,0)}),crossroads.addRoute("/background/:section:",function(e){t("background",App.initBackground),e?Util.scrollTo(e):window.scrollTo(0,0)}),crossroads.addRoute("/contact",function(){t("contact",App.initContact),window.scrollTo(0,0)}),crossroads.ignoreState=!0,hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()};var n=["who","costs","results"]}(),NProgress.start(),App.initialize(function(){Routing.precompileTemplates(),Routing.initializeRoutes(),NProgress.done()}),App.buildCapacityDescription=function(t){var e=App.getCapacity(t);d3.selectAll(".capacity-name").text(t.toUpperCase()+" - "+e.name),d3.selectAll(".capacity-target").text(e.target_description),e.desired_impact?d3.selectAll(".capacity-desired-impact").text(e.desired_impact):d3.selectAll(".capacity-desired-impact-container").style("display","none"),e.notes?d3.selectAll(".capacity-additional-notes").text(e.notes):d3.selectAll(".capacity-additional-notes-container").style("display","none"),$(".capacity-description-header").click(function(){$(".capacity-description-details").toggle(),$("#chevron").toggleClass("rotate-chevron")})};var Charts={};!function(){var t={indicator:"indicateur","core capacity":"capacité de base","core element":"élément clé"};Charts.buildProgressChart=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={top:35,right:45,bottom:35,left:50},r=n.width||630,i=n.height||36,o=d3.selectAll(t).append("svg").classed("progress-chart",!0).attr("width",r+a.left+a.right).attr("height",i+a.top+a.bottom),s=o.append("g").attr("transform","translate("+a.left+", "+a.top+")"),c=n.radius||9,l=n.rectHeight||i/2,p=d3.scaleLinear().domain([1,5]).range([0,r]),u=o.append("defs");u.append("filter").attr("id","blur").append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation","1");var d=u.append("pattern").attr("id","diagonalHatch").attr("patternUnits","userSpaceOnUse").attr("width",4).attr("height",4);d.append("rect").attr("x",-1).attr("y",-1).attr("width",6).attr("height",6).attr("fill","white").attr("stroke","none"),d.append("path").attr("d","M-1,1 l2,-2, M0,4 l4,-4, M3,5 l2,-2").attr("stroke","black").attr("stroke-width",.5);return s.selectAll(".color-bar").data([{x0:1,x1:1.5,color:"rgb(200, 33, 39)"},{x0:1.5,x1:3.5,color:"rgb(247, 236, 19)"},{x0:3.5,x1:5,color:"rgb(21, 108, 55)"}]).enter().append("rect").attr("class","color-bar").attr("x",function(t){return p(t.x0)}).attr("width",function(t){return p(t.x1)-p(t.x0)}).attr("height",i).style("fill",function(t){return t.color}).attr("filter","url(#blur)"),s.append("rect").attr("class","base").attr("width",r).attr("height",i),s.append("rect").attr("class","bar bar-0").attr("x",p(1)).attr("y",(i-l)/2).attr("width",p(e[0])-p(1)).attr("height",l).attr("fill","#777"),s.append("rect").attr("class","bar bar-1").attr("x",p(e[0])).attr("y",(i-l)/2).attr("width",p(e[1])-p(e[0])).attr("height",l).attr("fill","url(#diagonalHatch)"),s.append("circle").attr("class","marker marker-0").attr("cx",p(e[0])).attr("cy",i/2).attr("r",c),s.append("circle").attr("class","marker marker-1").attr("cx",p(e[1])).attr("cy",i/2).attr("r",c),s.append("line").attr("class","label-line").attr("x1",p(e[0])).attr("x2",p(e[0])).attr("y1",-10).attr("y2",i/2-c),s.append("text").attr("class","label-text").attr("x",p(e[0])).attr("y",-21).attr("dy",".35em").text("fr"===App.lang?"Score actuel":"Current Score"),s.append("line").attr("class","label-line").attr("x1",p(e[1])).attr("x2",p(e[1])).attr("y1",i+10).attr("y2",i/2+c),s.append("text").attr("class","label-text").attr("x",p(e[1])).attr("y",i+21).attr("dy",".35em").text("fr"===App.lang?"Score cible":"Target Score"),s},Charts.buildCostChart=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n={top:70,right:30,bottom:70,left:100},a=d3.select(e).append("svg").attr("class","cost-chart").attr("width",810+n.left+n.right).attr("height",320+n.top+n.bottom),r=a.append("g").attr("transform","translate("+n.left+", "+n.top+")");a.append("defs").append("clipPath").attr("id","chart-clip").append("rect").attr("y",-n.top).attr("width",810+n.right).attr("height",320+n.top);var i=d3.scaleBand().range([0,810]),o=d3.scaleLinear().range([320,0]),s=d3.scaleLinear().domain([0,810]).range(["rgb(255, 0, 0)","rgb(0, 66, 118)"]),c=d3.scaleLinear().domain([320,0]).range([5,25]),l=d3.axisBottom(),p=d3.axisLeft().ticks(6).tickSizeInner(-810).tickFormat(function(t){return 0===t?"0":App.siFormat(t)}),u=r.append("g").attr("class","x axis").attr("transform","translate(0, 320)"),d=r.append("g").attr("class","y axis"),f=r.append("g").attr("clip-path","url(#chart-clip)"),m=r.append("g").attr("class","axis-labels").attr("transform","translate(-100,0)"),g=m.append("text").attr("class","axis-label x-axis-label").attr("x",85).attr("y",380),h=m.append("text").attr("class","axis-label y-axis-label-1").attr("y",-32);return m.append("text").attr("class","axis-label y-axis-label-2").attr("y",-15).text("fr"===App.lang?"(en "+App.whoAmI.currency_iso+")":"(in "+App.whoAmI.currency_iso+")"),r.update=function(e,n,a){var m=e||r.currData;e&&(r.currData=e);var g=n||r.currXValFunc;n&&(r.currXValFunc=n);var h=a||r.currYValFunc;a&&(r.currYValFunc=a),i.domain(m.map(g)),o.domain([0,1.1*d3.max(m,h)]),l.scale(i),p.scale(o),u.call(l),d.call(p);var v=i.bandwidth();u.selectAll(".tick text").call(wrap,v),u.selectAll(".tick text").each(function(t){if(!$(this).hasClass("tooltipstered")){var e=App.getCapacity(t);if(e)return void $(this).tooltipster({content:"<b>"+t+"</b> - "+e.name});var n=App.getIndicator(t.toLowerCase());if(n)return void $(this).tooltipster({content:"<b>"+t+"</b> - "+n.name})}}),d.selectAll(".tick text").attr("x",-11);var A=f.selectAll(".indicator-blob").data(m);A.exit().remove(),A.enter().append("circle").attr("class","indicator-blob").each(function(){$(this).tooltipster({maxWidth:400,interactive:!0,content:""})}).merge(A).on("click",function(t){if("indicator"===t.type){var e=[];App.getCapacity(t.capId).indicators.forEach(function(t){e=e.concat(t.actions)});r.update(e,function(t){var e=t.id.split(".");e.pop();return e.join(".").toUpperCase()},h)}}).transition().duration(1200).attr("r",function(t){return c(o(h(t)))}).attr("cx",function(t){return i(g(t))+v/2+v/2*(Math.random()-.5)}).attr("cy",function(t){return o(h(t))}).style("fill",function(t){return s(i(g(t)))}).each(function(e,n){var a=[{name:"fr"===App.lang?"Coût de démarrage":"Startup Cost",value:e.startupCost},{name:"fr"===App.lang?"Coût d'investissement":"Capital Cost",value:e.capitalCost},{name:"fr"===App.lang?"Coût récurrent":"Recurring Cost",value:e.recurringCost,unit:"fr"===App.lang?"/an":"/yr"}],r=d3.select(document.createElement("div")),i=r.append("div").attr("class","cc-tooltip");i.append("div").attr("class","cc-tooltip-title").text("fr"===App.lang?Util.capitalize(t[e.type])+" ("+e.id.toUpperCase()+")":Util.capitalize(e.type)+" ("+e.id.toUpperCase()+")"),i.append("div").attr("class","cc-tooltip-subtitle").text((App.lang,e.name));var o=i.selectAll(".cc-tooltip-block").data(a).enter().append("div").attr("class","cc-tooltip-block");o.append("div").text(function(t){var e=App.moneyFormat(t.value);return t.unit?e+t.unit:e}),o.append("div").text(function(t){return t.name});var s=i.append("div").attr("class","cc-tooltip-button-container").append("button").attr("class","cc-tooltip-button btn btn-secondary").text("fr"===App.lang?"Aller au calcul de coûts":"Go to Costing");if("indicator"===e.type){var c=e.id.split("."),l="hasher.setHash('costs/"+c.slice(0,c.length-1).join("-")+"/"+c[c.length-1]+"')";s.attr("onClick",l)}else if("action"===e.type){console.log(e);var p=e.id.split("."),u="hasher.setHash('costs/"+p.slice(0,p.length-2).join("-")+"/"+p[p.length-2]+"')";s.attr("onClick",u)}$(this).tooltipster("content",r.html())})},r.updateXAxisLabel=function(t){g.text(t)},r.updateYAxisLabel=function(t){h.text(t)},r},Charts.buildBubblePack=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(App.lang,{"Coordination / leadership":"#f2f0f7","Planning including assessment, design, planning, policy, legislation":"#dadaeb","Strengthening HR capacity":"#bcbddc","Strengthening infrastructure":"#9e9ac8","Operations / implementation":"#807dba","Analysis including data quality and dissemination":"#6a51a3","Use and review mechanisms":"#4a1486"}),r={top:60,right:30,bottom:60,left:95},i=d3.select(t).append("svg").attr("class","bubble-chart").attr("width",580+r.left+r.right).attr("height",300+r.top+r.bottom).append("g").attr("class","bubble-pack").attr("transform","translate("+r.left+", "+r.top+")"),o=[],s=0;s<Object.keys(e).length;s++){var c={},l=Object.keys(e)[s];c.name=l,"total"===n.costType&&(c.value=e[l]["start-up"]+e[l].recurring*n.totalCostDuration+e[l].capital),o.push(c)}e=o;var p=i,u=d3.format(",d"),d=(d3.scaleOrdinal(d3.schemeCategory20),d3.pack().size([580,300]).padding(1.5)),f=d3.forceCollide(function(t){return t.r+1}),m=d3.forceSimulation().force("charge",d3.forceManyBody()).force("collide",f).force("x",d3.forceX(290).strength(.05)).force("y",d3.forceY(150).strength(.05)),g=d(d3.hierarchy({children:e}).sum(function(t){return t.value})).leaves().map(function(t){var e=t.data;return{x:290+3*(t.x-290),y:150+3*(t.y-150),r:0,radius:t.r+5,id:e.cat,cat:e.cat,name:e.name,value:e.value,icon:e.icon,desc:e.desc}});m.nodes(g).on("tick",function(){h.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("circle").attr("r",function(t){return t.r})}),p.style("background-color","#eee");var h=p.selectAll(".node").data(g).enter().append("g").attr("class","node").call(d3.drag().on("start",function(t){d3.event.active||m.alphaTarget(.2).restart(),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||m.alphaTarget(0),t.fx=null,t.fy=null}));h.append("circle").attr("id",function(t){return t.id}).attr("r",0).attr("class","bubble").attr("stroke-width","1px").transition().duration(2e3).ease(d3.easeElasticOut).tween("circleIn",function(t){var e=d3.interpolateNumber(0,t.radius);return function(n){t.r=e(n),m.force("collide",f)}}),h.append("clipPath").attr("id",function(t){return"clip-"+t.id}).append("use").attr("xlink:href",function(t){return"#"+t.id}),h.append("title").text(function(t){return t.name+"\n"+u(t.value)}),h.on("mouseover",function(t){d3.select(this).select("circle").attr("stroke-width","3px").attr("stroke","black")}),h.on("mouseout",function(t){d3.select(this).select("circle").attr("stroke",function(t){return d3.color(a[t.name]).darker().toString()}).attr("stroke-width","1px")})}}();var Colors={};Colors.jeeRed="#C12025",Colors.jeeYellow="#EDE929",Colors.jeeGreen="#87C764",Colors.scoreColors={1:Colors.jeeRed,2:Colors.jeeYellow,3:Colors.jeeYellow,4:Colors.jeeGreen,5:Colors.jeeGreen,"":"#bbb"},App.definitions={en:{totalCost:"The <b>total cost</b>, depending on the duration selected, is the sum of the startup cost, capital cost, and recurring costs.",startupCost:"<b>Startup costs</b> are one-time expenses incurred in the first year, excluding construction and durable equipment costs.",capitalCost:"<b>Capital costs</b> are non-recurring costs incurred in the first year for construction and durable equipment.",recurringCost:"<b>Recurring costs</b> are annual operating expenses, including salaries."},fr:{totalCost:"Le <b>coût total</b>, en fonction de la durée sélectionnée, est la somme du coût de démarrage, du coût d'investissement et des coûts récurrents.",startupCost:"Les <b>coûts de démarrage</b> sont des dépenses ponctuelles engagées la première année, à l'exclusion des coûts de construction et d'équipement.",capitalCost:"Les <b>coûts d'investissement</b> sont des coûts non récurrents engagés la première année pour la construction et l'équipement durable.",recurringCost:"Les <b>coûts récurrents</b> sont les charges d'exploitation annuelles, y compris les salaires."}},App.getSessionData=function(){var t={},e={};return App.jeeTree.forEach(function(n){n.capacities.forEach(function(n){n.indicators.forEach(function(n){t[n.id]=n.score||0,n.actions.forEach(function(t){t.inputs.forEach(function(t){var n={costed:t.costed,isCustomCost:t.isCustomCost};t.isCustomCost&&(n.customStartupCost=t.customStartupCost,n.customRecurringCost=t.customRecurringCost),e[t.id]=n})})})})}),JSON.stringify({whoAmI:App.whoAmI,globalBaseCosts:App.globalBaseCosts,globalStaffMultipliers:App.globalStaffMultipliers,scoreData:t,costData:e,user:User})},App.loadSessionData=function(t,e){var n=void 0;try{n=JSON.parse(t)}catch(t){return!1}for(var a in n.user)User[a]=n.user[a];App.whoAmI=n.whoAmI,App.globalBaseCosts=n.globalBaseCosts,App.globalStaffMultipliers=n.globalStaffMultipliers;var r=n.scoreData,i=n.costData,o=void 0===n.globalBaseCosts||void 0===n.globalStaffMultipliers,s=function(t,e,a,r){a?d3.json(t,function(t){r(null,t)}):r(null,n[e])};d3.queue(1).defer(s,"data/global_base_costs.json","globalBaseCosts",o).defer(s,"data/global_staff_multipliers.json","globalStaffMultipliers",o).defer(d3.json,"data/jee_costing_data.json").await(function(t,n,a,s){App.globalBaseCosts=n,App.globalStaffMultipliers=a,App.jeeTree=s,App.jeeTree.forEach(function(t){t.capacities.forEach(function(t){t.indicators.forEach(function(t){r[t.id]&&(t.score=r[t.id]),t.actions.forEach(function(t){t.inputs.forEach(function(t){if(i[t.id])for(var e in i[t.id])t[e]=i[t.id][e]})})})})}),void 0!==User.lang&&(App.lang=User.lang),App.changeLanguage(App.lang),e(!0,o)})},App.loadQlickScoreData=function(t){var e=void 0;try{e=XLSX.read(t,{type:"binary"})}catch(t){return!1}var n=e.SheetNames[0],a=e.Sheets[n];a.A1.w="country_name",a.B1.w="capacity_name",a.C1.w="indicator_name",a.D1.w="score";var r=XLSX.utils.sheet_to_json(a,{defval:""});return App.jeeTree.forEach(function(t){t.capacities.forEach(function(t){t.indicators.forEach(function(t){t.score=null})})}),r.forEach(function(t){var e=t.indicator_name.split(" ")[0].toLowerCase();if(""!==e){var n=+t.score;!isNaN(n)&&n>=1&&n<=5&&App.setIndicatorScore(e,n)}}),!0},App.exportLineItems=function(t){var e=App.getCompleteIndicatorTree(),n="fr"===App.lang?"Outil d'évaluation des coûts du RSI - Rapport détaillé - ":"IHR Costing Tool - Detailed Report - ",a=new XMLHttpRequest;a.open("POST","/lineItemExport",!0),a.responseType="blob",a.setRequestHeader("Content-type","application/json"),a.onload=function(e){if(200==this.status){var a=new Blob([this.response],{type:"application/vnd.ms-excel"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r;var o=new Date,s=o.getFullYear(),c=String(o.getMonth()+1);1===c.length&&(c="0"+c);var l=String(o.getDate());1===l.length&&(l="0"+l);var p=""+s+c+l+" "+App.whoAmI.abbreviation;return i.download=n+p+".xlsx",document.body.appendChild(i),i.click(),void(t&&t(null))}t&&t(this.status)},App.whoAmI.staff_overhead_perc_str=Util.percentizeDec(App.whoAmI.staff_overhead_perc),User.lang=App.lang,a.send(JSON.stringify({exportType:"userData",indicators:e,currencyCode:App.whoAmI.currency_iso,exchangeRate:App.getExchangeRate(),whoAmI:App.whoAmI,gbc:App.globalBaseCosts,gsm:App.globalStaffMultipliers,User:User}))},App.exportCostingWorksheet=function(t){var e=App.getAllIndicatorTree(),n=App.getScoredIndicatorTree(),a="fr"===App.lang?"Outil d'évaluation des coûts du RSI - Ligne de calcul des coûts - ":"IHR Costing Tool - Costing Worksheet - ",r=new XMLHttpRequest;r.open("POST","/lineItemExport",!0),r.responseType="blob",r.setRequestHeader("Content-type","application/json"),r.onload=function(e){if(200==this.status){var n=new Blob([this.response],{type:"application/vnd.ms-excel"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r;var o=new Date,s=o.getFullYear(),c=String(o.getMonth()+1);1===c.length&&(c="0"+c);var l=String(o.getDate());1===l.length&&(l="0"+l);var p=""+s+c+l,u=(App.whoAmI.abbreviation,p);return i.download=a+u+".xlsx",document.body.appendChild(i),i.click(),void(t&&t(null))}t&&t(this.status)},App.whoAmI.staff_overhead_perc_str=Util.percentizeDec(App.whoAmI.staff_overhead_perc),e.forEach(function(t){delete t.score_descriptions,t.actions.forEach(function(t){t.inputs.forEach(function(t){t.line_items.forEach(function(t){delete t.category_tag,delete t.function_tag,delete t.where_find_base_cost,delete t.references,delete t.unique_id})})})}),n.forEach(function(t){delete t.score_descriptions,t.actions.forEach(function(t){t.inputs.forEach(function(t){t.line_items.forEach(function(t){delete t.category_tag,delete t.function_tag,delete t.where_find_base_cost,delete t.references,delete t.unique_id})})})}),User.lang=App.lang,r.send(JSON.stringify({exportType:"costingWorksheet",indicators:e,userRelevantInd:n,currencyCode:App.whoAmI.currency_iso,exchangeRate:App.getExchangeRate(),whoAmI:App.whoAmI,gbc:App.globalBaseCosts,gsm:App.globalStaffMultipliers,User:User}))},App.geoJson={},App.createLeafletMap=function(){App.mapConfig={divId:"leaflet-map",view:{coordinates:[20,0],zoom:2},url:{en:"https://api.mapbox.com/styles/v1/mvanmaele/cjhi7ddzm08p12sne2e1jsms7/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibXZhbm1hZWxlIiwiYSI6ImNpeWx0ZnZzYTAwM2YzMmw3cTYwdGt1ejIifQ.Ja_TgAIXRhED-PXg8XXHVg",fr:"https://api.mapbox.com/styles/v1/mvanmaele/cjhi7eqd71ob62rped5yb63yy/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibXZhbm1hZWxlIiwiYSI6ImNpeWx0ZnZzYTAwM2YzMmw3cTYwdGt1ejIifQ.Ja_TgAIXRhED-PXg8XXHVg"}[App.lang],options:{attribution:{en:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',fr:'Données cartographiques &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributeurs, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagerie © <a href="http://mapbox.com">Mapbox</a>'}[App.lang],maxZoom:8,minZoom:2,id:"mapbox.light",accessToken:"pk.eyJ1IjoibXZhbm1hZWxlIiwiYSI6ImNpeWx0ZnZzYTAwM2YzMmw3cTYwdGt1ejIifQ.Ja_TgAIXRhED-PXg8XXHVg"},styles:{default:{stroke:!0,weight:0,fill:!0,color:"transparent"},active:{fillColor:"#ff7a7a"},selected:{fillColor:"#dd0000",weight:1,color:"#333"}}};var t=void 0,e=void 0,n="",a=function(t){var e=t.target;n!==e.feature.properties.iso_a2&&e.setStyle(App.mapConfig.styles.active)},r=function(t){t.target;n!==t.target.feature.properties.iso_a2&&(App.geoJson.resetStyle(t.target),e.update())},i=function(t){var e=t.target.feature.properties.iso_a2;if(e===n)return n="",App.geoJson.resetStyle(t.target),void(App.whoAmI={});n=e,App.geoJson.eachLayer(function(t){e===t.feature.properties.iso_a2?t.setStyle(App.mapConfig.styles.selected):App.geoJson.resetStyle(t)}),App.updateCountry(e)},o=function(t,e){e.on({mouseover:a,mouseout:r,click:i}),App.whoAmI.hasOwnProperty("abbreviation")&&App.whoAmI.abbreviation===e.feature.properties.iso_a2&&(e.setStyle(App.mapConfig.styles.selected),n=App.whoAmI.abbreviation)};return setTimeout(function(){t=L.map(App.mapConfig.divId,{zoomSnap:.1}).setView(App.mapConfig.view.coordinates,App.mapConfig.view.zoom),L.tileLayer(App.mapConfig.url,App.mapConfig.options).addTo(t),(e=L.control({position:"topright"}).setPosition("topright")).onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},e.update=function(t){this._div.innerHTML=t&&t.name?"<p>"+t.name+"</p>":""},$.getJSON("data/custom.geo.json",function(e){App.geoJson=L.geoJson(e,{style:App.mapConfig.styles.default,onEachFeature:o}).addTo(t)}),e.addTo(t),e.setPosition("topright")},100),t},App.buildTabNavigation=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.split(".")[0],r=d3.select(t).selectAll(".block-link-capacities").data(App.jeeTree).enter().append("div").attr("class","block-link-capacities"),i=r.append("div").attr("class","block-link-capabilities-header").classed("active",function(t){return"Other"===t.name||"Autre"===t.name?t.active=!App.normalCcIds.includes(a):t.active=t.id===a}).on("click",function(t){var e=hasher.getHashAsArray(),n=t.capacities[0].id.replace(".","-");hasher.setHash(e[0]+"/"+n+"/1")});i.append("div").attr("class","block-link-cover");i.append("svg").attr("class","chevron").attr("viewBox","0 0 24 24").classed("active",function(t){return t.active}).attr("src","img/chevron-right.png").append("path").attr("d","M8 5v14l11-7z"),i.append("span").text(function(t){return t.name});var o=r.append("div").style("display",function(t){return t.active?"block":"none"}).selectAll(".block-link").data(function(t){return t.capacities}).enter().append("div").attr("class","block-link").classed("active",function(t){return t.id===e}).on("click",function(t){var e=hasher.getHashAsArray(),n=t.id.replace(".","-");hasher.setHash(e[0]+"/"+n+"/1")});o.append("div").attr("class","block-link-title").html(function(t){return t.id.toUpperCase()+" - "+t.name}),o.append("div").attr("class","block-link-subtitle").classed("active",function(t){return t.id===e}).html(function(t){if(n.displayCostingProgress){return App.getNumIndicatorsCosted(t)+" of "+t.indicators.length}return t.indicators.filter(function(t){return t.score}).length+" of "+t.indicators.length}),o.append("div").attr("class","block-link-cover")},d3.json("./data/tmp/jee_costing_data-en.json",function(t){en=t}),d3.queue(1).defer(d3.json,"./data/tmp/jee_costing_data-en.json").defer(d3.json,"./data/tmp/jee_costing_data-fr.json").await(function(t,e,n){function a(t,e){var n=t.includes(".")?t.split(".")[0].toLowerCase():"a",a=t.toLowerCase(),r=e.find(function(t){return t.id===n});return r?r.capacities.find(function(t){return t.id===a}):null}var r=e.map(function(t){return $.extend(!0,{},t)});getIndicator=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?2:1,r=t.split(".").slice(0,e).join(".").toLowerCase(),i=t.toLowerCase(),o=a(r,n);return o?o.indicators.find(function(t){return t.id===i}):null},getAction=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?3:2,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=getIndicator(n);return r?r.actions.find(function(t){return t.id===a}):null},getInput=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?4:3,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=getAction(n);return r?r.inputs.find(function(t){return t.id===a}):null},getLineItem=function(t){var e=App.normalCcIds.includes(t.split(".")[0])?5:4,n=t.split(".").slice(0,e).join(".").toLowerCase(),a=t.toLowerCase(),r=getInput(n);return r?r.line_items.find(function(t){return t.id===a}):null};var i={Prevent:"Prévenir",Detect:"Détecter",Respond:"Riposter",Other:"Autre"};r.forEach(function(t){t.name_fr=i[t.name],t.name_en=t.name;var e=["name","target_description","as_measured_by","desired_impact","notes"];console.log(t.capacities.forEach),t.capacities.forEach(function(t){var r=a(t.id,n);e.forEach(function(e){t[e+"_fr"]=r[e]||"",t[e+"_en"]=t[e]||""});var i=["name","score_descriptions"];t.indicators.forEach(function(t){var e=t.id,a=getIndicator(e,n);i.forEach(function(e){t[e+"_fr"]=a[e]||"",t[e+"_en"]=t[e]||""}),t.actions.forEach(function(t){var e=t.id,a=getAction(e,n);t.name_fr=a.name,t.name_en=t.name,t.inputs.forEach(function(t){var e=t.id,a=getInput(e,n);t.name_fr=a.name,t.name_en=t.name;var r=["name","description","category_tag","function_tag","custom_multiplier_1","custom_multiplier_2","references","where_find_base_cost"];t.line_items.forEach(function(t){var e=t.id,a=getLineItem(e,n);r.forEach(function(e){t[e+"_fr"]=a[e]||"",t[e+"_en"]=t[e]||""})})})})})})}),console.log("jcd_both"),console.log(r)}),d3.queue(1).defer(d3.json,"./data/tmp/global_base_costs-en.json").defer(d3.json,"./data/tmp/global_base_costs-fr.json").await(function(t,e,n){var a=e.map(function(t){return $.extend(!0,{},t)});a.forEach(function(t){var e=t.id,a=n.find(function(t){return t.id===e});["name","description","tab_name","subheading_name","cost_unit"].forEach(function(e){t[e+"_en"]=t[e],t[e+"_fr"]=a[e]})}),console.log("gbc_both"),console.log(a)}),d3.queue(1).defer(d3.json,"./data/tmp/global_staff_multipliers-tmp.json").await(function(t,e){e.forEach(function(t){["name","description","tab_name","subheading_name"].forEach(function(e){t[e]=t[e+"_en"]})}),console.log("gsm_both"),console.log(e)}),App.changeLanguage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fr";t=t.toLowerCase().trim(),App.jeeTree.forEach(function(t){t.name=t["name_"+App.lang];var e=["name","target_description","as_measured_by","desired_impact","notes"];t.capacities.forEach(function(t){e.forEach(function(e){t[e]=t[e+"_"+App.lang]});var n=["name","score_descriptions"];t.indicators.forEach(function(t){n.forEach(function(e){t[e]=t[e+"_"+App.lang]}),t.actions.forEach(function(t){t.name=t["name_"+App.lang],t.inputs.forEach(function(t){t.name=t["name_"+App.lang];var e=["name","description","category_tag","function_tag","custom_multiplier_1","custom_multiplier_2","references","where_find_base_cost"];t.line_items.forEach(function(t){e.forEach(function(e){t.name=t[e+"_"+App.lang]})})})})})})})};var ceHash={Prevent:"Prévenir",Detect:"Détecter",Respond:"Riposter"};jee_costing_data.forEach(function(t){t.name=ceHash[t.name],t.forEach(function(t){var e=core_capacities.find(function(e){return e.id===t.id}).fr;t.name=e.name,t.target_description=e.target_description,t.desired_impact=e.desired_impact,t.notes=e.notes,t.as_measured_by="",t.forEach(function(t){var e=indicators.find(function(e){return e.id===t.id});t.name=e.fr,t.score_descriptions={},t.score_descriptions=e.score_descriptions.map(function(e){t.score_descriptions[e.score]=e.fr})})})}),App.initBackground=function(){},App.initContact=function(){},App.initCosting=function(t,e){function n(){App.buildTabNavigation(".block-link-container",i,{displayCostingProgress:!0}),function(){var t="fr"===App.lang?"capacity-description-fr":"capacity-description";$(".capacity-description-container").html(Routing.templates[t]()),App.buildCapacityDescription(i),"Immunization"===s.name&&$(".capacity-tooltip-img").show().tooltipster({interactive:!0,content:'An alternative method to estimate vaccination costs is available using the <a href="http://www.avenirhealth.org/software-onehealth.php" target="_blank">OneHealth Tool</a>'})}(),function(){function n(t,e){var n=_.append("div").style("display",function(t){return App.getNeededLineItems(t.line_items,c.score).filter(e).length?"block":"none"});n.append("div").attr("class","item-details-title").text(t);var a=n.append("div").attr("class","line-item-table-container").append("table").attr("class","line-item-table table table-condensed table-striped").append("tbody"),r=a.selectAll("tr").data(function(t){return App.getNeededLineItems(t.line_items,c.score).filter(e)}).enter().append("tr"),i=r.append("td");i.append("span").text(function(t){return t.name}),i.append("img").attr("class","line-item-description-button").attr("src","img/question-mark.png").each(function(t){var e='<div class="li-tooltip-content">';e+="<b>"+t.name+":</b> "+t.description,e+="</div>",$(this).tooltipster({interactive:!0,trigger:"hover",content:e})}),r.append("td").text(function(t){return App.moneyFormatLong(t.cost)});var o=a.append("tr");return o.append("td").text("Total"),o.append("td").text(function(t){var n=App.getNeededLineItems(t.line_items,c.score).filter(e);return App.moneyFormatLong(d3.sum(n,function(t){return t.cost}))}),n}!function(){var t=s.indicators.length,e=App.getNumIndicatorsCosted(s);d3.select(".indicator-progress").text("fr"===App.lang?"Vérifier les coûts pour chaque indicateur ("+e+" sur "+t+") :":"Review costs for each indicator ("+e+" of "+t+"):")}();var i=d3.select(".indicator-container").selectAll(".indicator-slot-container").data(s.indicators).enter().append("div").attr("class","indicator-slot-container"),p=i.append("div").attr("class","indicator-slot").classed("active",function(t){return t.id===o}).classed("empty",function(t){return void 0===App.getIndicatorScore(t.id)}).on("click",function(e,n){hasher.setHash("costs/"+t+"/"+(n+1))});p.append("svg").attr("class","chevron").classed("active",function(t){return t.id===o}).attr("viewBox","0 0 24 24").append("path").attr("d","M8 5v14l11-7z"),p.append("div").attr("class","indicator-id").text(function(t){return t.id.toUpperCase()+" - "}),p.append("div").attr("class","indicator-name").text(function(t){return Util.truncateText(t.name)});p.append("div").attr("class","indicator-score").html(function(t){var e=App.getIndicatorScore(t.id);if(!e)return"fr"===App.lang?"<i>Pas de score</i>":"<i>No Score</i>";var n="step"===User.targetScoreType?e+1:User.targetScore,a='<img class="rp-score" src="img/rp-'+e+'.png" alt='+e+" />";return n>e&&e<4&&(a+=("fr"===App.lang?"<span> à </span>":"<span> to </span>")+'<img class="rp-score" src="img/rp-'+n+'.png" alt='+n+" />"),a});$(".indicator-description").html(o.toUpperCase()+" - "+c.name);var u=i.filter(function(t){return t.id===o});if(!c.score)return u.append("div").attr("class","no-score-container").html("fr"===App.lang?"Cet indicateur n'a pas encore été noté. Cliquez <u>ici</u> pour entrer un score.":"This indicator has not been scored yet. Click <u>here</u> to enter a score.").on("click",function(){hasher.setHash("scores/"+t+"/"+e)}),void $(".action-description-container").hide();if(!l.length){var d="fr"===App.lang?"Aucune action n'est requise pour augmenter le score actuel de cet indicateur":"There are no actions needed to increase the current score for this indicator";return 4===c.score?d="fr"===App.lang?"Les coûts pour passer du score 4 au score 5 sont très spécifiques au pays et ne sont pas inclus dans l'outil d'évaluation des coûts du RSI.":"Costs to increase from score <b>4</b> to <b>5</b> are highly country-specific and are not included in the IHR Costing Tool.":5===c.score&&(d="fr"===App.lang?"Les indicateurs avec un score de 5 ne nécessitent pas de coûts (aucune nouvelle action n'est requise).":"Indicators with a score of <b>5</b> do not require costing (no new actions required)."),u.append("div").attr("class","no-actions-container").html(d),void $(".action-description-container").hide()}var f=u.selectAll(".action-slot").data(l).enter().append("div").attr("class","action-slot-container"),m=f.append("div").attr("class","action-slot").attr("action-id",function(t){return t.id}).on("click",function(t){return a(t)});m.append("svg").attr("class","chevron").attr("viewBox","0 0 24 24").append("path").attr("d","M8 5v14l11-7z"),m.append("div").attr("class","action-name").text(function(t){return t.id.toUpperCase()+" - "+t.name}),m.append("div").attr("class","action-progress"),r();var g=f.append("div").attr("class","item-block-container").each(function(t){return t.itemShownIndex=0});g.append("div").attr("class","item-block-progress-text").text(function(t){return"fr"===App.lang?"Élément 1 sur "+App.getNeededInputs(t.inputs,c.score).length:"Item 1 of "+App.getNeededInputs(t.inputs,c.score).length}),g.append("div").attr("class","item-block-arrow-prev item-block-arrow").style("display","none").on("click",function(t){var e=$(this).parent();e.find(".item-block[item-index="+t.itemShownIndex+"]").animate({left:"800px"}),t.itemShownIndex--,e.find(".item-block[item-index="+t.itemShownIndex+"]").animate({left:"155px"});var n=App.getNeededInputs(t.inputs,c.score).length;e.find(".item-block-progress-text").text("fr"===App.lang?"Élément "+(t.itemShownIndex+1)+" sur "+App.getNeededInputs(t.inputs,c.score).length:"Item "+(t.itemShownIndex+1)+" of "+n),0===t.itemShownIndex&&$(this).hide(),e.find(".item-block-arrow-next").show()}).append("img").attr("src","img/prev-arrow.png").attr("alt","Previous"),g.append("div").attr("class","item-block-arrow-next item-block-arrow").style("display",function(t){return App.getNeededInputs(t.inputs,c.score).length>1?"block":"none"}).on("click",function(t){var e=$(this).parent();e.find(".item-block[item-index="+t.itemShownIndex+"]").animate({left:"-800px"}),t.itemShownIndex++,e.find(".item-block[item-index="+t.itemShownIndex+"]").animate({left:"155px"});var n=App.getNeededInputs(t.inputs,c.score).length;e.find(".item-block-progress-text").text("fr"===App.lang?"Élément "+(t.itemShownIndex+1)+" sur "+App.getNeededInputs(t.inputs,c.score).length:"Item "+(t.itemShownIndex+1)+" of "+n),t.itemShownIndex+1>=n&&$(this).hide(),e.find(".item-block-arrow-prev").show()}).append("img").attr("src","img/next-arrow.png").attr("alt","fr"===App.lang?"Suivant":"Next");var h=g.selectAll(".item-block").data(function(t){return App.getNeededInputs(t.inputs,c.score)}).enter().append("div").attr("class","item-block").attr("item-index",function(t,e){return e}).style("left",function(t,e){return 0===e?"155px":"800px"}).append("div").attr("class","item-shell"),v=h.append("div").attr("class","front").append("div").attr("class","item-front-shell"),A=h.append("div").attr("class","back");v.append("div").attr("class","item-title-container").append("div").attr("class","item-title").text(function(t){return t.name});var b=v.append("div").attr("class","item-startup-cost-container");b.append("div").attr("class","item-cost-name").text("fr"===App.lang?"Coût de démarrage: ":"Startup Cost: "),b.append("input").attr("class","startup-cost-input form-control").attr("value",function(t){var e=t.isCustomCost?t.customStartupCost:t.startupCost+t.capitalCost;return Util.comma(e)}).style("color",function(t){return t.costed?"black":"#999"}).on("change",function(t){t.isCustomCost=!0,t.customStartupCost=Util.getInputNumVal(this),t.customRecurringCost||(t.customRecurringCost=t.recurringCost),t.costed=!0;var e=$(this).closest(".item-block");e.find("input").css("color","black"),e.find(".item-save-button").removeClass("primary"),App.updateAllCosts()}),b.append("div").attr("class","item-cost-currency").text(App.whoAmI.currency_iso),b.append("img").attr("class","item-cost-tooltip-img").attr("src","img/question-mark.png").each(function(t){$(this).tooltipster({content:App.definitions[App.lang].startupCost})});var y=v.append("div").attr("class","item-recurring-cost-container");y.append("div").attr("class","item-cost-name").text("fr"===App.lang?"Coût récurrent: ":"Recurring Cost: "),y.append("input").attr("class","recurring-cost-input form-control").attr("value",function(t){var e=t.isCustomCost?t.customRecurringCost:t.recurringCost;return Util.comma(e)}).style("color",function(t){return t.costed?"black":"#999"}).on("change",function(t){t.isCustomCost=!0,t.customRecurringCost=Util.getInputNumVal(this),t.customStartupCost||(t.customStartupCost=t.startupCost+t.capitalCost),t.costed=!0;var e=$(this).closest(".item-block");e.find("input").css("color","black"),e.find(".item-save-button").removeClass("primary"),App.updateAllCosts()}),y.append("div").attr("class","item-cost-currency").text("fr"===App.lang?App.whoAmI.currency_iso+"/an":App.whoAmI.currency_iso+"/yr"),y.append("img").attr("class","item-cost-tooltip-img").attr("src","img/question-mark.png").each(function(t){$(this).tooltipster({content:App.definitions[App.lang].recurringCost})}),v.append("div").attr("class","item-save-cost-text").text("fr"===App.lang?"Sauvegardés!":"Costs Saved!");var C=v.append("div").attr("class","item-footer");C.append("div").attr("class","item-save-button").classed("primary",function(t){return!t.costed}).text("fr"===App.lang?"Sauvegarder les coûts":"Save Costs").on("click",function(t){t.costed=!0,$(this).removeClass("primary").closest(".item-block").find("input").css("color","black"),r();var e=App.getNumIndicatorsCosted(s);d3.select(".block-link-subtitle.active").text(e+" of "+s.indicators.length);var n=$(this).closest(".item-block").find(".item-save-cost-text");n.show(),setTimeout(function(){n.fadeOut(800)},1e3),App.updateAllCosts()}),C.append("div").attr("class","item-view-details-button").text("fr"===App.lang?"Voir les détails":"View Details").on("click",function(){$(this).closest(".item-block").toggleClass("active")});var _=A.append("div").attr("class","item-details-container");n("fr"===App.lang?"Coûts de démarrage / d'investissement par défaut":"Default Startup/Capital Costs",function(t){return"start-up"===t.line_item_type||"capital"===t.line_item_type}),n("fr"===App.lang?"Coûts récurrents par défaut":"Default Recurring Costs",function(t){return"recurring"===t.line_item_type});d3.selectAll(".item-details-container").each(function(t){var e=App.getNeededLineItems(t.line_items,c.score),n=e.filter(function(t){return"recurring"===t.line_item_type});n.length&&n.length<e.length&&d3.select(this).selectAll(".line-item-table-container").style("height","57px")}),_.append("div").attr("class","item-footer").append("div").attr("class","item-return-to-front-button").text("fr"===App.lang?"Revenir à modifier les coûts":"Return to Edit Cost").on("click",function(){$(this).closest(".item-block").toggleClass("active")})}(),l.length&&a(l[0]),d3.select(".next-cost").on("click",function(){var t=App.getNextIndicator(i,o);if(null===t)hasher.setHash("results");else{var e=t.id,n=e.lastIndexOf("."),a=e.slice(0,n).replace(".","-"),r=e.slice(n+1);hasher.setHash("costs/"+a+"/"+r)}}),d3.select(".previous-cost").on("click",function(){var t=App.getPrevIndicator(i,o).id;if(t){var e=t.lastIndexOf("."),n=t.slice(0,e).replace(".","-"),a=t.slice(e+1);hasher.setHash("costs/"+n+"/"+a)}})}function a(t){d3.selectAll(".action-slot-container, .action-slot").classed("active",function(e){return e.id===t.id}).select(".chevron").classed("active",function(e){return e.id===t.id});$(".action-slot-container:not(.active) .item-block-container").css("height","340px").css("min-height","0px").slideUp(400,function(){$(this).css("height","auto").css("min-height","340px")}),$(".action-slot-container.active .item-block-container").css("height","340px").css("min-height","0px").slideDown(400,function(){$(this).css("height","auto").css("min-height","340px")}),l.length?$(".action-description").html(t.id.toUpperCase()+" - "+t.name):$(".action-description").html("<i>No actions need to be taken to increase the score for this indicator</i>")}function r(){d3.selectAll(".action-progress").text(function(t){var e=App.getNeededInputs(t.inputs,c.score),n=e.filter(function(t){return t.costed}).length;return"fr"===App.lang?n+" sur "+e.length+" éléments évalués":n+" of "+e.length+" items costed"})}var i=Util.getIndicatorId(t),o=Util.getIndicatorId(t+"-"+e),s=App.getCapacity(i),c=App.getIndicator(o),l=App.getNeededActions(c);$(".go-to-results-button").click(function(){return hasher.setHash("results")}),n()},App.initCostsInstructions=function(){$(".target-score-option").click(function(){d3.selectAll(".target-score-option input").property("checked",!1),d3.select(this).select("input").property("checked",!0);var t=d3.select(this).attr("ind");if(User.targetScoreType=t,"target"===t){var e=$(this).find("select").val();User.targetScore=e}App.updateAllCosts()}),$(".target-score-select").on("change",function(){var t=$(this).val();User.targetScore=t,App.updateAllCosts(),4==+t?$(".color-bar").css("background-color","#87c764"):$(".color-bar").css("background-color","#ede929")}),$(".btn-blank-template").on("click",function(){App.exportCostingWorksheet()}),$(".costs-instructions-start").click(function(){hasher.setHash("costs")})},App.initCountry=function(){function t(t){if(""!==t.trim()){var e=App.countryParams.filter(function(t){return"French Guiana"!==t.name}),a=new Fuse(e,{threshold:.3,distance:1e5,keys:["abbreviation",n,"currency_iso"]}).search(t);if(i.show(),0===a.length)i.find(".live-search-no-results-text").show(),i.find(".live-search-results-contents").hide();else{i.find(".live-search-no-results-text").hide(),i.find(".live-search-results-contents").show();var r=d3.select(i[0]).select(".live-search-results-contents").selectAll(".live-search-results-box").data(a.slice(0,4));r.exit().remove();var o=r.enter().append("div").attr("class","live-search-results-box");o.append("div").attr("class","live-search-results-title"),o.append("div").attr("class","live-search-results-subtitle"),(r=r.merge(o).attr("code",function(t){return t.abbreviation}).on("mousedown",function(t){$(".country-search-input").val(""),App.updateCountry(t.abbreviation)})).select(".live-search-results-title").text(function(t){return t[n]}),r.select(".live-search-results-subtitle").text(function(t){return"Population: "+Util.comma(t.multipliers.population)})}}else i.hide()}App.createLeafletMap();var e=App.countryParams.slice(0),n="fr"===App.lang?"name_fr":"name",a="fr"===App.lang?"--- choisir un pays ---":"--- choose a country ---";e=e.filter(function(t){return"French Guiana"!==t.name}),Util.sortByKey(e,n),e.unshift({name:a,name_fr:a,abbreviation:""}),Util.populateSelect(".country-dropdown",e,{nameKey:n,valKey:"abbreviation"}),$(".country-dropdown").on("change",function(){App.updateCountry($(this).val())}),App.whoAmI.abbreviation&&$(".country-dropdown").val(App.whoAmI.abbreviation);var r=void 0,i=$(".live-search-results-container");$(".country-search-input").on("focus",function(){t($(this).val())}).on("blur",function(){clearTimeout(r),i.hide()}).on("keyup",function(e){clearTimeout(r);var n=$(this).val();13===e.which?t(n):r=setTimeout(function(){t(n)},250)}),App.setDefaultJeeScores=function(){var t=App.jeeScoreData[App.whoAmI.abbreviation];void 0===t?App.jeeTree.forEach(function(t){t.capacities.forEach(function(t){t.indicators.forEach(function(t){t.score=null})})}):App.jeeTree.forEach(function(e){e.capacities.forEach(function(e){e.indicators.forEach(function(e){var n=t.find(function(t){return t.indicator.split(" ")[0].toLowerCase()===e.id});e.score=n.score})})})},App.updateCountry=function(t){$(".country-dropdown").val(t),function(t){App.geoJson.eachLayer(function(e){e.feature.properties.iso_a2===t?e.setStyle(App.mapConfig.styles.selected):App.geoJson.resetStyle(e)})}(t);var e=App.countryParams.find(function(e){return e.abbreviation===t});App.whoAmI=JSON.parse(JSON.stringify(e)),App.jeeTree=App.cleanJeeTree.map(function(t){return $.extend(!0,{},t)}),App.changeLanguage(App.lang,{reset:!1}),App.setDefaultJeeScores(),App.updateAllCosts()},$(".go-to-assessment-button").click(function(){return hasher.setHash("overview")})},App.initHome=function(){var t=Util.getCookie("lang");""!==t?($(".enter-site.fr").remove(),$(".enter-site").text("fr"===t?"Commencer":"Start").click(function(){return hasher.setHash("country")})):($(".enter-site.fr").click(function(){App.changeLanguage("fr"),hasher.setHash("country")}),$(".enter-site.en").click(function(){App.changeLanguage("en"),hasher.setHash("country")}))},App.initOverview=function(){$(".next-button").click(function(){hasher.setHash("scores/")}),$(".btn-prior-session").on("click",function(){$(".input-prior-session").trigger("click")}),$(".input-prior-session").on("change",function(){if("files"in this){if(!this.files.length)return;var t=this.files[0];if(".ihr"!==t.name.slice(t.name.length-4))return void noty({timeout:5e3,text:"<b>Please select a file with a file type extension of <i>.ihr</i>"});var e=new FileReader;e.onload=function(t){NProgress.start(),App.loadSessionData(t.target.result,function(t,e){if(t){var n=void 0;n=e?"fr"===App.lang?"<b>Upload réussi!</b><br>Votre session précédente a été restaurée. Veuillez confirmer vos sélections sur la page <a href=\"#costs/population\">Définir les valeurs implicites</a> car elles n'ont peut-être pas été enregistrées par les versions antérieures de l'outil.":'<b>Upload Successful!</b><br>Your previous session has been restored. Please review your selections on the <a href="#costs/population">Set Default Values page</a>, as they may not have been saved by earlier versions of the tool.':"fr"===App.lang?"<b>Upload réussi!</b><br>Votre session précédente a été restaurée.":"<b>Upload Successful!</b><br>Your previous session has been restored.",App.updateAllCosts(),noty({timeout:4e3,type:"success",text:n})}else{var a="fr"===App.lang?"<b>Erreur!</b><br>Une erreur s'est produite lors du téléchargement de votre session précédente.":"<b>Error!</b><br>There was an error loading your previous session.";noty({timeout:5e3,text:a})}NProgress.done()})},e.readAsBinaryString(t)}}),$(".btn-blank-template").on("click",function(){NProgress.start(),App.exportCostingWorksheet(function(){NProgress.done()})}),$(".btn-score-file").on("click",function(){$(".input-score-file").trigger("click")}),$(".input-score-file").on("change",function(){if("files"in this){if(!this.files.length)return;var t=this.files[0],e=t.name.split("."),n=e[e.length-1];if("xlsx"!==n&&"xls"!==n){App.lang;return void noty({timeout:5e3,text:"<b>Please select a file with a file type extension of <i>.xlsx</i>"})}var a=new FileReader;a.onload=function(t){NProgress.start();if(App.loadQlickScoreData(t.target.result)){var e="fr"===App.lang?"<b>Upload réussi!</b><br>Les données de score ont été téléchargées.":"<b>Upload Successful!</b><br>Score data has been uploaded.";App.updateAllCosts(),noty({timeout:4e3,type:"success",text:e})}else{var n="fr"===App.lang?"<b>Erreur!</b><br>Une erreur s'est produite lors du téléchargement des données de score. Veuillez vérifier le format de fichier.":"<b>Error!</b><br>There was an error uploading the score data. Please check the file format.";noty({timeout:5e3,text:n})}NProgress.done()},a.readAsBinaryString(t)}})},App.initResults=function(){function t(){return"total"===p?function(t){return t.startupCost+t.capitalCost+u*t.recurringCost}:"startup"===p?function(t){return t.startupCost}:"capital"===p?function(t){return t.capitalCost}:"recurring"===p?function(t){return t.recurringCost}:function(t){return 0}}function e(e){return t()(e)}function n(){k.update(function(){var t=[],e=$(".category-select").val();return"capacity"===l?h.forEach(function(n){var a=Object.assign({},n),r=b.filter(function(t){return t.id===n.id&&e.includes(t.category_tag)});a.startupCost=d3.sum(r,function(t){return t.startupCost}),a.capitalCost=d3.sum(r,function(t){return t.capitalCost}),a.recurringCost=d3.sum(r,function(t){return t.recurringCost}),t.push(a)}):"category"===l&&(t=(t=b).filter(function(t){return e.includes(t.category_tag)})),t.filter(function(t){return d.includes(t.capId)})}(),"capacity"===l?function(t){return t.capId.toUpperCase()}:"category"===l?function(t){return t.category_tag}:function(t){return 0},t()),function(){var t="";"capacity"===l?t="fr"===App.lang?"Capacité":"Capacity":"category"===l&&(t="fr"===App.lang?"Fonction":"Function");k.updateXAxisLabel(t)}(),a()}function a(){var t="";"total"===p?t="fr"===App.lang?"Coût sur "+u+" an"+(1===u?"":"s"):u+"-Year Cost":(console.log(f),t="fr"===App.lang?f[p]:p.charAt(0).toUpperCase()+p.slice(1)+" Cost"),k.updateYAxisLabel(t)}function r(){i(".total-cost-number",d3.sum(App.jeeTree,function(t){return e(t)})),d3.selectAll(".summary-text-box .big-number").each(function(t){m.find(function(e){return e.name===t.name})?i(this,e(t)):d3.select(this).text("-")})}function i(t,e){var n=d3.select(t);isNaN(Util.strToFloat(n.text()))&&n.text(App.moneyFormat(1e6)),n.transition().duration(300).tween("text",function(t){var n=d3.select(this),a=d3.interpolateNumber(Util.strToFloat(n.text()),e);return function(t){return n.text(App.moneyFormat(a(t)))}})}function o(t,e){return t.length===$(e).children().length?"fr"===App.lang?"Tous sélectionnés":"All selected":t.length>0?"fr"===App.lang?t.length+" sélectionnés":t.length+" selected":0===t.length?"fr"===App.lang?"Aucune sélection":"None selected":void 0}function s(){var t=[],e=[];App.jeeTree.forEach(function(n){for(var a=!1,r=n.capacities.map(function(t){return t.id}),i=0;i<d.length;i++)if(r.includes(d[i])){a=!0,t.push(n.id);break}a||e.push(n.id)}),$(".cc-select").multiselect("select",t,!1).multiselect("deselect",e,!1);var n=g.filter(function(t){return!d.includes(t.id)}).map(function(t){return t.id});$(".capacity-select").multiselect("select",d,!1).multiselect("deselect",n,!1)}function c(t,e,n){var a=d3.select(t);a.append("thead").append("tr").selectAll("th").data(T).enter().append("th").attr("class",function(t){return t.className||""}).text(function(t){return t.name.replace("[level]",n)});var r=a.append("tbody");r.selectAll("tr").data(e).enter().append("tr").selectAll("td").data(function(t){return T.map(function(e){return{rowData:t,colData:e}})}).enter().append("td").attr("class",function(t){return t.colData.className||""}).text(function(t){return(t.colData.format||function(t){return t})(t.colData.getValue(t.rowData))});r.append("tr").attr("class","total-row").selectAll("td").data(T).enter().append("td").attr("class","cost").text(function(t){return"cost"===t.className?App.moneyFormatLong(d3.sum(e,t.getValue)):""})}var l="capacity",p="total",u=1,d=[],f={startup:"Coût de démarrage",capital:"Coût d'investissement",recurring:"Coût récurrent"},m=[],g=[],h=[],v=[],A=[],b=[],y={};if(App.jeeTree.forEach(function(t){var e=!1;t.capacities.forEach(function(n){var a=!1;n.indicators.forEach(function(r){if(App.isIndicatorComplete(r)){e=!0,a=!0;var i=Object.assign({},r);i.ccId=t.id,i.capId=n.id,h.push(i),i.costByTag={};App.getNeededActions(i).forEach(function(t){v.push(Object.assign({},t));App.getNeededInputs(t.inputs,i.score).forEach(function(t){var e={},n=App.getNeededLineItems(t.line_items,i.score),a=d3.sum(n,function(t){return t.cost});n.forEach(function(t){var n=t.function_tag;e[n]||(e[n]=0),e[n]+=a?t.cost/a:1});for(var r in e)i.costByTag[r]||(i.costByTag[r]={startupCost:0,capitalCost:0,recurringCost:0}),t.isCustomCost?(i.costByTag[r].startupCost+=Math.round(e[r]*t.customStartupCost),i.costByTag[r].recurringCost+=Math.round(e[r]*t.customRecurringCost)):(i.costByTag[r].startupCost+=Math.round(e[r]*t.startupCost),i.costByTag[r].capitalCost+=Math.round(e[r]*t.capitalCost),i.costByTag[r].recurringCost+=Math.round(e[r]*t.recurringCost))})});for(var o in i.costByTag)if(o){var s=Object.assign({},i),c=i.costByTag[o];0===o.indexOf("Planning")||0===o.indexOf("Analysis")||0===o.indexOf("Planification")||0===o.indexOf("Analyse")?s.category_tag=o.split(" ")[0]:s.category_tag=o;for(var l in c)s[l]=c[l];b.push(s),y[o]||(y[o]={startupCost:0,capitalCost:0,recurringCost:0});for(var p in c)y[o][p]+=c[p]}}}),a&&g.push(n)}),e&&m.push(t)}),!m.length)return $(".results-content").hide(),void $(".results-empty-content").on("click",function(){return hasher.setHash("scores/p-1/1")}).show();A=_.unique(b.map(function(t){return t.category_tag})),$(".num-costed-indicators").text(h.length),$(".num-costed-capacities").text(g.length),$(".view-table-button").on("click",function(){var t=$(this);t.toggleClass("table-view");var e=t.hasClass("table-view"),n="fr"===App.lang?"Voir les graphiques":"View Charts",a="fr"===App.lang?"Afficher le tableau de données":"View Data Table";t.text(e?n:a),$(".results-main-content, .results-table-content").slideToggle()}),$(".view-export-button").on("click",function(){var t=$(this);t.toggleClass("export-view");if(t.hasClass("export-view"))$(".results-instructions, .results-main-content, .results-table-content").slideUp(),$(".view-table-button").hide(),t.html("fr"===App.lang?"&laquo; Revenir aux résultats":"&laquo; Back to Results");else{var e=$(".view-table-button").hasClass("table-view");$(".results-instructions").slideDown(),e?$(".results-table-content").slideDown():$(".results-main-content").slideDown(),$(".view-table-button").show(),t.html("fr"===App.lang?"Exporter des données":"Export Data")}}),$(".cost-type-row button").each(function(){var t=$(this).attr("value");$(this).tooltipster({content:App.definitions[App.lang][t+"Cost"]})}).on("click",function(){p=$(this).attr("value"),$('.cost-type-row button[value="'+p+'"]').addClass("active").siblings().removeClass("active"),"total"===p?$(".cost-duration-row").slideDown():$(".cost-duration-row").slideUp(),r(),a(),k.update(null,null,t())}),$(".cost-duration-row button").on("click",function(){u=+$(this).attr("value"),$('.cost-duration-row button[value="'+u+'"]').addClass("active").siblings().removeClass("active"),r(),a(),k.update(null,null,t())}),$(".view-cost-by-box .filter-row").on("click",function(){var t=$(this);t.find("input").prop("checked",!0),t.siblings(".filter-row").find("input").prop("checked",!1),l=t.attr("value"),n()}),$(".reset-button").on("click",function(){n()});var C=App.getAverageCurrentScore(h),x=App.getAverageTargetScore(h);Charts.buildProgressChart(".progress-chart-overall",[C,x]);var w=d3.select(".summary-text-section").selectAll(".summary-text-box").data(App.jeeTree).enter().append("div").attr("class","summary-text-box").each(function(t){t.isEmpty=!m.find(function(e){return e.name===t.name}),t.isEmpty&&$(this).tooltipster({interactive:!0,content:"There are <b>no scored/costed indicators</b> for this core element. Click <span onclick=\"hasher.setHash('scores/"+t.id+"-1/1')\">here</span> to go to the scoring page for this core element."})}).on("click",function(t){t.isEmpty||function(t){d=t.capacities.map(function(t){return t.id}),s(),n();var e=$(".chart-section").position().top+110;$("html, body").animate({scrollTop:e},600)}(t)});w.append("div").attr("class",function(t){if(!t.isEmpty){var e=[];t.capacities.forEach(function(t){e=e.concat(t.indicators)});var n=App.getAverageTargetScore(e),a="green";return n<2?a="red":n<4&&(a="yellow"),"summary-text-box-veil "+a}return"summary-text-box-veil"});var I=w.append("div").attr("class","summary-text-box-content");I.append("div").attr("class","big-number-text").html(function(t){return"fr"===App.lang?"Coût "+("Autre"===t.name?"d'":"de ")+t.name:t.name+" Cost"}),I.append("div").attr("class","big-number"),d3.select(".total-cost-number").text(App.moneyFormat(1e6));var k=Charts.buildCostChart(".cost-chart-container");Util.populateSelect(".cc-select",App.jeeTree,{nameKey:"name",valKey:"id",selected:!0}),Util.populateSelect(".capacity-select",g,{nameKey:function(t){return t.id.toUpperCase()+" - "+t.name},valKey:"id",selected:!0}),Util.populateSelect(".category-select",A,{selected:!0}),$(".cc-select").multiselect({includeSelectAllOption:!0,numberDisplayed:1,selectAllText:"fr"===App.lang?"Tout sélectionner":"Select all",buttonText:o,buttonClass:"btn btn-secondary",onChange:function(t,e){var a=App.jeeTree.find(function(e){return e.id===t.val()}).capacities.map(function(t){return t.id});e?a.forEach(function(t){d.includes(t)||d.push(t)}):d=d.filter(function(t){return!a.includes(t)}),s(),n()},onSelectAll:function(){d=g.map(function(t){return t.id}),s(),n()},onDeselectAll:function(){d=[],s(),n()}}),$(".capacity-select").multiselect({includeSelectAllOption:!0,numberDisplayed:0,buttonClass:"btn btn-secondary",buttonText:o,selectAllText:"fr"===App.lang?"Tout sélectionner":"Select all",onChange:function(t,e){var a=t.val();e?d.includes(a)||d.push(a):d=d.filter(function(t){return t!==a}),s(),n()},onSelectAll:function(){d=g.map(function(t){return t.id}),s(),n()},onDeselectAll:function(){d=[],s(),n()}}),$(".category-select").multiselect({includeSelectAllOption:!0,numberDisplayed:0,selectAllText:"fr"===App.lang?"Tout sélectionner":"Select all",buttonClass:"btn btn-secondary",buttonText:o,onChange:function(t,e){return n()},onSelectAll:function(){return n()},onDeselectAll:function(){return n()}}),d=g.map(function(t){return t.id}),s(),r(),n(),$(".table-tab-container button").on("click",function(){$(this).addClass("active").siblings().removeClass("active");var t=$(this).val();$(".table-container").slideUp(),$("."+t+"-table-container").slideDown()});var S="fr"===App.lang?"coût":"cost",T=[{name:"ID",getValue:function(t){return t.id.toUpperCase()}},{name:"fr"===App.lang?"[level]":"[level] Name",getValue:function(t){return t.name}},{name:"fr"===App.lang?"Coût de démarrage":"Startup Cost",className:"cost",format:App.moneyFormatLong,getValue:function(t){return t.startupCost}},{name:"fr"===App.lang?"Coût d'investissement":"Capital Cost",className:S,format:App.moneyFormatLong,getValue:function(t){return t.capitalCost}},{name:"fr"===App.lang?"Coût récurrent":"Recurring Cost",className:"cost",format:App.moneyFormatLong,getValue:function(t){return t.recurringCost}},{name:"fr"===App.lang?"Coût sur 1 an":"1-Year Cost",className:S,format:App.moneyFormatLong,getValue:function(t){return t.startupCost+t.capitalCost+t.recurringCost}},{name:"fr"===App.lang?"Coût sur 3 ans":"3-Year Cost",className:S,format:App.moneyFormatLong,getValue:function(t){return t.startupCost+t.capitalCost+3*t.recurringCost}},{name:"fr"===App.lang?"Coût sur 5 ans":"5-Year Cost",className:S,format:App.moneyFormatLong,getValue:function(t){return t.startupCost+t.capitalCost+5*t.recurringCost}}];c(".core-table",m,"fr"===App.lang?"Élément clé":"Core Element"),c(".capacity-table",g,"fr"===App.lang?"Capacité de base":"Capacity"),c(".indicator-table",h,"fr"===App.lang?"Indicateur":"Indicator"),c(".action-table",v,(App.lang,"Action")),$(".capacity-table-container").show(),$(".export-data-button").on("click",function(){NProgress.start(),App.exportLineItems(function(t){t&&noty({text:"<b>Warning!</b><br>There was an error exporting the detailed report. Please contact the administrators of the tool."}),NProgress.done()})}),$(".export-session-button").on("click",function(){var t=App.getSessionData(),e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1);1===a.length&&(a="0"+a);var r=String(e.getDate());1===r.length&&(r="0"+r);var i=""+n+a+r,o=""+App.whoAmI.abbreviation+i;App.downloadText(o,t)}),$(".export-empty-template-button").on("click",function(){NProgress.start(),App.exportCostingWorksheet(function(){NProgress.done()})})},App.initScores=function(t,e){function n(){App.buildTabNavigation(".block-link-container",r,{includeScoreBars:!0}),function(){var t="fr"===App.lang?"capacity-description-fr":"capacity-description";$(".capacity-description-container").html(Routing.templates[t]()),App.buildCapacityDescription(r),"Immunization"===o.name&&$(".capacity-tooltip-img").show().tooltipster({interactive:!0,content:'An alternative method to estimate vaccination costs is available using the <a href="http://www.avenirhealth.org/software-onehealth.php" target="_blank">OneHealth Tool</a>'})}(),function(){a();var e=d3.select(".indicator-container").selectAll(".indicator-slot").data(o.indicators).enter().append("div").attr("class","indicator-slot").classed("active",function(t){return t.id===i}).classed("empty",function(t){return void 0===App.getIndicatorScore(t.id)}).on("click",function(e,n){hasher.setHash("scores/"+t+"/"+(n+1))});e.append("div").attr("class","indicator-name").text(function(t){return t.id.toUpperCase()+" - "+Util.truncateText(t.name)});var n=e.append("div").attr("class","indicator-score");n.append("span").attr("class","score-none").style("display",function(t){return App.getIndicatorScore(t.id)?"none":"inline"}).html("fr"===App.lang?"<i>Pas de score</i>":"<i>No Score</i>");for(var r=function(t){n.append("img").attr("class","rp-score").attr("src","img/rp-"+t+".png").attr("alt",t).attr("score",t).style("display",function(e){return+App.getIndicatorScore(e.id)===t?"inline":"none"})},c=1;c<=5;c++)r(c);$(".indicator-description").html(i.toUpperCase()+" - "+s.name)}(),function(){var t=d3.select(".score-picker-table tbody").selectAll("tr").data(d3.range(1,6)).enter().append("tr").attr("class","score-row").classed("active",function(t){return t===s.score}).on("click",function(t){var e=d3.select(this),n=e.select("input").property("checked"),r=n?void 0:t,o=d3.selectAll(".score-row").classed("active",!1);o.select("input").property("checked",!1),o.select(".score-description-cell").text(function(t){var e=s.score_descriptions[t];return e.length>300?e.slice(0,300)+"...":e}),e.classed("active",!n),e.select("input").property("checked",!n),d3.select(".score-row.active .score-description-cell").text(function(t){return s.score_descriptions[t]}),App.setIndicatorScore(i,r);var c=d3.select(".indicator-slot.active .indicator-score");r?(c.select(".score-none").style("display","none"),c.selectAll("img").style("display",function(){return+$(this).attr("score")==+t?"inline":"none"})):(c.select(".score-none").style("display","inline"),c.selectAll("img").style("display","none")),App.updateAllCosts(),a()});t.append("td").append("input").attr("type","radio").property("checked",function(t){return t===s.score}).on("click",function(){$(this).prop("checked",!$(this).prop("checked"))});var e=t.append("td");e.append("img").attr("class","rp-score-table-img rp-score").attr("src",function(t){return"img/rp-"+t+".png"}),e.append("span").attr("class","score-label").text(function(t){return App.scoreLabels[t]}),t.append("td").attr("class","score-description-cell").text(function(t){var e=s.score_descriptions[t];return e.length>300?e.slice(0,300)+"...":e}),t.append("td")}(),d3.select(".next-score").on("click",function(){var t=App.getNextIndicator(r,i).id;t||hasher.setHash("costsinstructions");var e=t.lastIndexOf("."),n=t.slice(0,e).replace(".","-"),a=t.slice(e+1);hasher.setHash("scores/"+n+"/"+a)}),d3.select(".previous-score").on("click",function(){var t=App.getPrevIndicator(r,i).id;if(t){var e=t.lastIndexOf("."),n=t.slice(0,e).replace(".","-"),a=t.slice(e+1);hasher.setHash("scores/"+n+"/"+a)}}),$(".go-to-costing-button").click(function(){return hasher.setHash("costsinstructions")})}function a(){var t=o.indicators.length,e=o.indicators.filter(function(t){return t.score}).length,n="fr"===App.lang?"Sélectionnez un score pour chaque indicateur ("+e+" of "+t+") :":"Select a score for each indicator ("+e+" of "+t+"):";d3.select(".indicator-progress").text(n),d3.select(".block-link-subtitle.active").text(e+" of "+t)}var r=Util.getIndicatorId(t).toLowerCase(),i=Util.getIndicatorId(t+"-"+e).toLowerCase(),o=App.getCapacity(r),s=App.getIndicator(i);App.scoreLabels="fr"===App.lang?{1:"Pas de capacité",2:"Capacité limitée",3:"Capacité développée",4:"Capacité démontrée",5:"Capacité durable"}:{1:"No Capacity",2:"Limited Capacity",3:"Developed Capacity",4:"Demonstrated Capacity",5:"Sustainable Capacity"},App.prevHash||(App.prevHash="");var c=App.prevHash.split("/");"scores"!==c[0]||c[1],App.prevHash=hasher.getHash(),n()},function(){var t="#fff3cd",e=void 0;App.initWho=function(t){if(e="en"===App.lang?[{abbr:"population",name:"Population and Currency"},{abbr:"country-details",name:"Country Details"},{abbr:"default-costs",name:"Cost Assumptions (optional)",children:["personnel","technology","printing","meetings"]},{abbr:"personnel",tabName:"Personnel compensation",name:"Personnel Compensation",level:1},{abbr:"technology",name:"Technology and Infrastructure",level:1},{abbr:"printing",name:"Printing",level:1},{abbr:"meetings",name:"Meetings",level:1}]:[{abbr:"population",name:"Population et devise"},{abbr:"country-details",name:"Détails du pays"},{abbr:"default-costs",name:"Hypothèses de coûts (facultatif)",children:["personnel","technology","printing","meetings"]},{abbr:"personnel",tabName:"Rémunération du personnel",name:"Rémunération du personnel",level:1},{abbr:"technology",name:"Technologie et infrastructure",level:1},{abbr:"printing",name:"Travaux d'impression",level:1},{abbr:"meetings",name:"Réunions",level:1}],"default-costs"!==t){switch(t){case"population":n();break;case"country-details":a();break;default:r(t)}var i=d3.select(".block-link-container").selectAll(".block-link").data(e).enter().append("div").attr("class","block-link").attr("level",function(t){return t.level}).classed("active",function(e){return e.children?e.children.includes(t):t===e.abbr}).style("display",function(e){return e.level?["personnel","technology","printing","meetings"].includes(t)?"inline-block":"none":"inline-block"}).on("click",function(t){return hasher.setHash("costs/"+t.abbr)});i.append("svg").attr("class","chevron").classed("active",function(t){return"default-costs"===t.abbr}).attr("viewBox","0 0 24 24").attr("src","img/chevron-right.png").style("display",function(e){return e.children&&e.children.includes(t)?"inline":t===e.abbr?"inline":"none"}).append("path").attr("d","M8 5v14l11-7z"),i.append("div").attr("class","block-link-title").html(function(t){return t.name}),i.append("div").attr("class","block-link-cover"),$(".defn").tooltipster({functionInit:function(t,e){var n=t._$origin.attr("defn");if("pop"===n){var a="This is the estimated total population for the country chosen. The number can be changed using the edit box below";return t.content(a),a}if("geo"===n){var r="This is the estimated total population for the country chosen. The number can be changed using the edit box below";return t.content(r),r}if("phi"===n){var i="This is the estimated total population for the country chosen. The number can be changed using the edit box below";return t.content(i),i}}})}else hasher.setHash("costs/personnel")};var n=function(){function e(){var e=Math.round(App.whoAmI.multipliers.population)===Math.round(n);if($(".population-input").css("background-color",e?"#fff":t),e)$(".default-pop-text").slideUp();else{var a="fr"===App.lang?"Défaut : ":"Default: ";$(".default-pop-text").text(a+" "+Util.comma(n)).slideDown()}}$(".population-block").slideDown();var n=App.countryParams.find(function(t){return t.name===App.whoAmI.name}).multipliers.population,a=App.whoAmI.multipliers.population;e(),$(".population-input").val(Util.comma(a)).on("change",function(){App.whoAmI.multipliers.population=Util.getInputNumVal(this),e(),App.updateAllCosts()});var r="fr"===App.lang?"name_fr":"name",i=[];for(var o in App.currencies)i.push({name:App.currencies[o][r],code:App.currencies[o].iso.code});Util.sortByKey(i,"name"),Util.populateSelect(".currency-select",i,{nameKey:"name",valKey:"code"}),$(".currency-select").val(App.whoAmI.currency_iso).on("change",function(){App.whoAmI.currency_iso=$(this).val(),App.updateAllCosts()}),$(".next-button").click(function(){return hasher.setHash("costs/country-details")})},a=function(){$(".country-details-block").slideDown();var t="fr"===App.lang?[{nameAttr:"intermediate_1_area_name",valueAttr:"intermediate_1_area_count",description:"Intermédiaire (par exemple, province, district)",nameValues:["Province","Municipalité","District","Etat"],optional:!1},{nameAttr:"intermediate_2_area_name",valueAttr:"intermediate_2_area_count",description:"Intermédiaire 2 (facultatif)",tooltipContent:"Dans les pays ayant plusieurs niveaux intermédiaires qui participent à des activités liées au RSI, les zones intermédiaires 2 sont plus petites que le premier niveau intermédiaire mais plus grand que les unités géopolitiques locales. Cette valeur est facultative. Si le nombre de zones intermédiaires 2 n'est pas fournie, cette valeur sera supposée être nulle et aucune activité ne sera chiffrée pour les zones intermédiaires 2.",nameValues:["Province","Municipalité","District","Etat","Commune"],optional:!0},{nameAttr:"local_area_name",valueAttr:"local_area_count",description:"Local (par exemple, commune, ville)",nameValues:["Barangay","Ville","Circonscription électorale","Commune","District"],optional:!1}]:[{nameAttr:"intermediate_1_area_name",valueAttr:"intermediate_1_area_count",description:"Intermediate (e.g., province, district)",nameValues:["Province","Municipality","District","State"],optional:!1},{nameAttr:"intermediate_2_area_name",valueAttr:"intermediate_2_area_count",description:"Intermediate 2 (optional)",tooltipContent:"In countries with multiple intermediate levels that participate in IHR-related activities, intermediate 2 areas are smaller than the first intermediate level but larger than local areas. This value is optional. Unless a number of intermediate 2 areas is specified, this value will be assumed to be zero and no activities will be costed for intermediate 2 areas.",nameValues:["Province","Municipality","District","State","County"],optional:!0},{nameAttr:"local_area_name",valueAttr:"local_area_count",description:"Local (e.g., county, city)",nameValues:["Barangay","City","Constituency","County","District"],optional:!1}],e={District:"District",Country:"Pays",Province:"Province",Barangay:"Barangay",County:"Commune",Municipality:"Municipalité",State:"Etat",City:"Ville",Constituency:"Circonscription électorale"},n=_.invert(e),a="fr"===App.lang?"-- sélectionnez un --":"-- select one --",r=d3.select(".geo-division-table tbody").selectAll("tr").data(t).enter().append("tr");r.append("td").html(function(t){var e=t.description+("fr"===App.lang?" ":"")+":";return t.tooltipContent&&(e+=' <img class="info-img admin-help tooltipstered" title="'+t.tooltipContent+'" src="img/info.png">'),e}),r.append("td").append("select").attr("class","form-control").classed("french","fr"===App.lang).each(function(t){var n=[a].concat(t.nameValues);Util.populateSelect(this,n);var r=App.whoAmI[t.nameAttr];r&&$(this).val("fr"===App.lang?e[r]:r)}).on("change",function(t){var e=$(this).val();"fr"===App.lang?App.whoAmI[t.nameAttr]=e===a?"":n[e]:App.whoAmI[t.nameAttr]=e===a?"":e}),r.append("td").append("input").attr("class","form-control").attr("value",function(t){return Util.comma(App.whoAmI.multipliers[t.valueAttr])}).on("change",function(t){App.whoAmI.multipliers[t.valueAttr]=Util.getInputNumVal(this),App.updateAllCosts()});var i="fr"===App.lang?[{name:"central_hospitals_count",description:'Nombre d\'établissements de santé dans le pays : <img class="committed-info-img info-img tooltipstered" id="healthcare-help" src="img/info.png">',unit:"établissements / pays"}]:[{name:"central_hospitals_count",description:'Number of healthcare facilities in the country: <img class="committed-info-img info-img tooltipstered" id="healthcare-help" src="img/info.png">',unit:"healthcare facilities / country"}],o=d3.select(".ph-table tbody").selectAll("tr").data(i).enter().append("tr");o.append("td").html(function(t){return""+t.description});var s=o.append("td");s.append("input").attr("class","form-control").attr("value",function(t){return t.defaultValue=App.whoAmI.multipliers[t.name],Util.comma(t.defaultValue)}).on("change",function(t){App.whoAmI.multipliers[t.name]=Util.getInputNumVal(this),App.updateAllCosts()}),s.append("span").text(function(t){return t.unit});var c="fr"===App.lang?"Préciser le nombre d'établissements de santé publics participant aux activités liées au RSI, y compris les diagnostics au point de service pour les maladies prioritaires, et les programmes de biosécurité et de biosécurité.":"Specify the number of public healthcare facilities participating in IHR-related activities, including point-of-care diagnostics for priority diseases, and biosafety and biosecurity programs.";$("#healthcare-help").tooltipster({content:c,trigger:"hover",side:"top"}),$(".admin-help").tooltipster({trigger:"hover",side:"top"}),$(".next-button").click(function(){return hasher.setHash("costs/personnel")}),$(".proceed-button").click(function(){return hasher.setHash("costs/p-1/1")})},r=function(n){function a(e,n){var a=d3.select(n),i=!0,o="fr"===App.lang?"Défaut: ":"Default: ";if(e.indexOf("gbc")>-1){if("gbc.overhead"===e)i=.6===App.whoAmI.staff_overhead_perc,o+="60";else if(null!==e){var s=App.globalBaseCosts.find(function(t){return t.id===e});i=Math.round(s.default_cost)===Math.round(s.cost),o+=Util.comma(s.default_cost*r)}}else{var c=App.globalStaffMultipliers.find(function(t){return t.id===e});i=c.default_count===c.count,o+=Util.comma(c.default_count)}a.style("background-color",function(){return i?"#fff":t});var l=$(d3.select(a.node().parentNode).select(".dv-default-text").node());i?l.slideUp():l.text(o).slideDown()}$(".default-costs-block").slideDown();var r=App.getExchangeRate(),i=App.globalBaseCosts.filter(function(t){if(!t.show_on_dv)return!1;var a=e.find(function(t){return t.abbr===n});return a.tabName?t.tab_name===a.tabName:t.tab_name===a.name}),o="personnel";if("personnel"===n){o="technology";i.push("en"===App.lang?{cost:.6,cost_unit:"% per year",description:"Additional amount that will be budgeted for employee overhead expenses, as a percentage of the employee's annual salary",id:"gbc.overhead",name:"Overhead percentage",tab_name:"Personnel compensation",subheading_name:"Salaries"}:{cost:.6,cost_unit:"% par an",description:"Montant additionnel qui sera budgété pour les frais généraux des employés, en pourcentage du salaire annuel de l'employé",id:"gbc.overhead",name:"Pourcentage de frais généraux",tab_name:"Rémunération du personnel",subheading_name:"Salaires"})}if("technology"===n){o="printing";i.push("fr"===App.lang?{type:"radio",values:["Acheter","Louer"],description:"Choix d'achat ou de location de l'installation",name:"Acheter ou louer un espace d'installation",tab_name:"Technologie et infrastructure",subheading_name:"Infrastructure"}:{type:"radio",values:["Buy","Lease"],description:"Choice of either buying or leasing facility space",name:"Buy or lease facility space",tab_name:"Technology and Infrastructure",subheading_name:"Infrastructure"})}"printing"===n&&(o="meetings");var s={Buy:"Buy",Lease:"Lease",Acheter:"Buy",Louer:"Lease"};if("meetings"===n){$(".next-button").addClass("hidden"),$(".proceed-button").removeClass("hidden");for(var c=0;c<App.globalStaffMultipliers.length;c++)i.push(App.globalStaffMultipliers[c])}i.forEach(function(t){"Printing"===t.tab_name&&(t.subheading_name="Printing")});for(var l=_.unique(_.pluck(i,"tab_name")),p=[],u=function(t){var e=l[t],n={};n[e]=[];for(var a=i.filter(function(t){return t.tab_name===e}),r=_.unique(_.pluck(a,"subheading_name")),o=function(t){var i=r[t],o={};o[i]=[];var s=a.filter(function(t){return t.subheading_name===i});o[i]=s,n[e].push(o)},s=0;s<r.length;s++)o(s);p.push(n)},d=0;d<l.length;d++)u(d);for(var f=0;f<p.length;f++){var m=p[f],g=Object.keys(m)[0];f>0&&d3.select(".dv-container").append("div").attr("class","dv-divider");for(var h=d3.select(".dv-container").append("div").attr("class","dv-tab-content"),v=0;v<m[g].length;v++){var A=h.append("div").attr("class","dv-subheading-row").append("div").attr("class","dv-subheading-col"),b=m[g][v],y=Object.keys(b)[0];A.append("h3").attr("class","dv-h3").text(y);for(var C=0;C<b[y].length;C++){var x=b[y][C],w=x.name,I=A.append("div").attr("class","dv-item-row row").append("div").attr("class","dv-item-col col-sm-12"),k=I.append("div").attr("class","dv-item-name-container");k.append("div").attr("class","dv-item-name").append("b").text(w),k.append("div").attr("class","dv-description").text(x.description);var S=I.append("div").attr("class","dv-input-group");if(x.id)S.append("input").attr("class","dv-input form-control").attr("gbcid",x.id),x.id.indexOf("gbc")>-1?("Overhead percentage"!==w&&"Pourcentage de frais généraux"!==w&&S.append("span").attr("class","dv-currency"),S.append("span").attr("class","dv-cost-unit").text(" "+x.cost_unit)):S.append("span").attr("class","dv-cost-unit").text("en"===App.lang?" attendees":" participants"),S.append("div").attr("class","dv-default-text default-text");else{S.append("div").attr("class","btn-group").selectAll("div").data(x.values).enter().append("div").attr("class","btn btn-secondary").classed("active",function(t){return s[t].toLowerCase()===User.buyOrLease}).text(function(t){return t}).on("click",function(t){$(this).addClass("active").siblings().removeClass("active"),User.buyOrLease=s[t].toLowerCase(),App.updateAllCosts()})}}}}$(".dv-input").on("change",function(){var t=d3.select(this).attr("gbcid");if(t.indexOf("gbc")>-1){if("gbc.overhead"===t)App.whoAmI.staff_overhead_perc=Util.getInputNumVal(this)/100;else if(null!==t){App.globalBaseCosts.find(function(e){return e.id===t}).cost=Util.getInputNumVal(this)/r}}else{App.globalStaffMultipliers.find(function(e){return e.id===t}).count=Util.getInputNumVal(this)}a(t,this),App.updateAllCosts()}),d3.selectAll(".dv-input").each(function(){var t=d3.select(this),e=t.attr("gbcid");if(e.indexOf("gbc")>-1){if("gbc.overhead"===e)t.node().value=Util.comma(100*App.whoAmI.staff_overhead_perc);else if(null!==e){var n=App.globalBaseCosts.find(function(t){return t.id===e});t.node().value=Util.comma(n.cost*r)}}else{var i=App.globalStaffMultipliers.find(function(t){return t.id===e});t.node().value=Util.comma(i.count)}$(".dv-currency").text(App.whoAmI.currency_iso),a(e,this)}),$(".next-button").click(function(){return hasher.setHash("costs/"+o)}),$(".proceed-button").click(function(){return hasher.setHash("costs/p-1/1")})}}();